<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"8.0.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>

  <meta name="description" content="https:&#x2F;&#x2F;frida.re&#x2F;docs&#x2F;home&#x2F; https:&#x2F;&#x2F;www.frida.re&#x2F;docs&#x2F;javascript-api JavaScript API 一 JavaScript API 二 非越狱环境使用Frida    Frida集成到iOS项目 https:&#x2F;&#x2F;codeshare.frida.re&#x2F; 中其它共享的脚本， $ frida --codeshare 脚本路径 -f Y">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2022/10/17/%E9%80%86%E5%90%91-Frida/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="https:&#x2F;&#x2F;frida.re&#x2F;docs&#x2F;home&#x2F; https:&#x2F;&#x2F;www.frida.re&#x2F;docs&#x2F;javascript-api JavaScript API 一 JavaScript API 二 非越狱环境使用Frida    Frida集成到iOS项目 https:&#x2F;&#x2F;codeshare.frida.re&#x2F; 中其它共享的脚本， $ frida --codeshare 脚本路径 -f Y">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2022/10/17/%E9%80%86%E5%90%91-Frida/逆向-Frida/frida-trace.png">
<meta property="article:published_time" content="2022-10-17T01:01:44.842Z">
<meta property="article:modified_time" content="2023-05-19T03:37:45.337Z">
<meta property="article:author" content="daxun">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/10/17/%E9%80%86%E5%90%91-Frida/逆向-Frida/frida-trace.png">


<link rel="canonical" href="http://example.com/2022/10/17/%E9%80%86%E5%90%91-Frida/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title> | Hexo</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Hexo</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">简单记录下</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#Frida-%E5%AE%89%E8%A3%85"><span class="nav-number">1.</span> <span class="nav-text">Frida 安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Frida"><span class="nav-number">2.</span> <span class="nav-text">Frida</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#frida-ls-device"><span class="nav-number">2.1.</span> <span class="nav-text">frida-ls-device</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#frida-ps"><span class="nav-number">2.2.</span> <span class="nav-text">frida-ps</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#frida-kill"><span class="nav-number">2.3.</span> <span class="nav-text">frida-kill</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#frida-trace"><span class="nav-number">3.</span> <span class="nav-text">frida-trace</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%B7%9F%E8%B8%AA%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8"><span class="nav-number">3.1.</span> <span class="nav-text">跟踪函数调用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%B7%9F%E8%B8%AAOC%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8"><span class="nav-number">3.2.</span> <span class="nav-text">跟踪OC方法调用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%B7%9F%E8%B8%AA%E5%AF%BC%E5%87%BA%E5%87%BD%E6%95%B0"><span class="nav-number">3.3.</span> <span class="nav-text">跟踪导出函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%B7%9F%E8%B8%AA%E5%AF%BC%E5%85%A5%E5%87%BD%E6%95%B0"><span class="nav-number">3.4.</span> <span class="nav-text">跟踪导入函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%B7%9F%E8%B8%AA%E5%81%8F%E7%A7%BB%E5%9C%B0%E5%9D%80"><span class="nav-number">3.5.</span> <span class="nav-text">跟踪偏移地址</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%B7%9F%E8%B8%AA%E8%B0%83%E7%94%A8%E6%A0%88"><span class="nav-number">3.6.</span> <span class="nav-text">跟踪调用栈</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%9B%E5%85%A5%E4%BA%A4%E4%BA%92%E6%A8%A1%E5%BC%8F"><span class="nav-number">4.</span> <span class="nav-text">进入交互模式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E8%84%9A%E6%9C%AC"><span class="nav-number">4.1.</span> <span class="nav-text">加载脚本</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8Interceptor"><span class="nav-number">5.</span> <span class="nav-text">拦截器Interceptor</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#attach%E6%8B%A6%E6%88%AAC%E5%87%BD%E6%95%B0"><span class="nav-number">5.1.</span> <span class="nav-text">attach拦截C函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#attach%E6%8B%A6%E6%88%AA-OC%E6%96%B9%E6%B3%95"><span class="nav-number">5.2.</span> <span class="nav-text">attach拦截 OC方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8B%A6%E6%88%AA%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="nav-number">5.3.</span> <span class="nav-text">拦截自定义函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#replace%E6%9B%BF%E6%8D%A2OC%E6%96%B9%E6%B3%95"><span class="nav-number">5.4.</span> <span class="nav-text">replace替换OC方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#replace%E6%9B%BF%E6%8D%A2C%E5%87%BD%E6%95%B0"><span class="nav-number">5.5.</span> <span class="nav-text">replace替换C函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#implementation%E6%96%B9%E5%BC%8F%E6%9B%BF%E6%8D%A2%E6%96%B9%E6%B3%95"><span class="nav-number">5.6.</span> <span class="nav-text">implementation方式替换方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BF%9D%E5%AD%98%E6%97%A5%E5%BF%97"><span class="nav-number">5.7.</span> <span class="nav-text">保存日志</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#API%E6%9F%A5%E6%89%BE%E5%99%A8ApiResolver"><span class="nav-number">6.</span> <span class="nav-text">API查找器ApiResolver</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9F%A5%E6%89%BEOC%E6%96%B9%E6%B3%95"><span class="nav-number">6.1.</span> <span class="nav-text">查找OC方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%95%E8%BF%87AFNetworking%E8%AF%81%E4%B9%A6%E6%A0%A1%E9%AA%8C"><span class="nav-number">6.2.</span> <span class="nav-text">绕过AFNetworking证书校验</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9F%A5%E6%89%BEC%E6%96%B9%E6%B3%95"><span class="nav-number">6.3.</span> <span class="nav-text">查找C方法</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JS%E8%84%9A%E6%9C%AC"><span class="nav-number">7.</span> <span class="nav-text">JS脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%89%93%E5%8D%B0OC%E5%8F%82%E6%95%B0"><span class="nav-number">7.1.</span> <span class="nav-text">打印OC参数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC"><span class="nav-number">7.2.</span> <span class="nav-text">常用脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%9E%9A%E4%B8%BE%E6%89%80%E6%9C%89%E7%B1%BB"><span class="nav-number">7.2.1.</span> <span class="nav-text">枚举所有类</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%9E%9A%E4%B8%BE%E4%B8%80%E4%B8%AA%E7%B1%BB%E7%9A%84%E6%89%80%E6%9C%89method"><span class="nav-number">7.2.2.</span> <span class="nav-text">枚举一个类的所有method</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%89%93%E5%8D%B0%E8%B0%83%E7%94%A8%E6%A0%88"><span class="nav-number">7.2.3.</span> <span class="nav-text">打印调用栈</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#hook-%E4%B8%80%E4%B8%AAmethod"><span class="nav-number">7.2.4.</span> <span class="nav-text">hook 一个method</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#hook%E5%B8%A6block%E6%96%B9%E6%B3%95"><span class="nav-number">7.2.5.</span> <span class="nav-text">hook带block方法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E5%B1%9E%E6%80%A7"><span class="nav-number">7.2.6.</span> <span class="nav-text">设置属性</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E4%BB%BB%E4%B8%80%E5%8A%A8%E6%80%81%E5%BA%93"><span class="nav-number">7.2.7.</span> <span class="nav-text">加载任一动态库</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E8%BF%9B%E7%A8%8B%E6%89%80%E6%9C%89%E6%A8%A1%E5%9D%97"><span class="nav-number">7.2.8.</span> <span class="nav-text">获取当前进程所有模块</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%85%B6%E5%AE%83%E6%96%B9%E6%B3%95"><span class="nav-number">7.2.9.</span> <span class="nav-text">其它方法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JS%E8%B0%83%E7%94%A8OC%E5%87%BD%E6%95%B0"><span class="nav-number">8.</span> <span class="nav-text">JS调用OC函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#C-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">9.</span> <span class="nav-text">C 数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#strings"><span class="nav-number">9.1.</span> <span class="nav-text">strings</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Numbers"><span class="nav-number">9.2.</span> <span class="nav-text">Numbers</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Pointer"><span class="nav-number">9.3.</span> <span class="nav-text">Pointer</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Hexdump"><span class="nav-number">9.4.</span> <span class="nav-text">Hexdump</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Memory-scanning"><span class="nav-number">9.5.</span> <span class="nav-text">Memory scanning</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Objective-C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86"><span class="nav-number">10.</span> <span class="nav-text">Objective-C数据类型处理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#NSString"><span class="nav-number">10.1.</span> <span class="nav-text">NSString</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#NSData"><span class="nav-number">10.2.</span> <span class="nav-text">NSData</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#NSDictionary"><span class="nav-number">10.3.</span> <span class="nav-text">NSDictionary</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#NSArray"><span class="nav-number">10.4.</span> <span class="nav-text">NSArray</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93"><span class="nav-number">10.5.</span> <span class="nav-text">结构体</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%B9%E8%B1%A1"><span class="nav-number">10.6.</span> <span class="nav-text">自定义对象</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Python-%E4%BA%A4%E4%BA%92"><span class="nav-number">11.</span> <span class="nav-text">Python 交互</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E8%AE%BE%E5%A4%87"><span class="nav-number">11.1.</span> <span class="nav-text">获取设备</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%99%84%E5%8A%A0%E8%BF%9B%E7%A8%8B"><span class="nav-number">11.2.</span> <span class="nav-text">附加进程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E8%BF%9B%E7%A8%8B"><span class="nav-number">11.3.</span> <span class="nav-text">启动进程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%84%B1%E7%A6%BB%E8%BF%9B%E7%A8%8B"><span class="nav-number">11.4.</span> <span class="nav-text">脱离进程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B3%A8%E5%85%A5JS%E8%84%9A%E6%9C%AC"><span class="nav-number">11.5.</span> <span class="nav-text">注入JS脚本</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Python%E4%B8%8EJS%E4%BA%A4%E4%BA%92%E4%BC%A0%E5%80%BC"><span class="nav-number">11.6.</span> <span class="nav-text">Python与JS交互传值</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#JS%E8%84%9A%E6%9C%AC-1"><span class="nav-number">11.7.</span> <span class="nav-text">JS脚本</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Swift-Hook"><span class="nav-number">12.</span> <span class="nav-text">Swift Hook</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B"><span class="nav-number">13.</span> <span class="nav-text">实例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A0%E5%AF%86%E5%8F%82%E6%95%B0%E6%89%93%E5%8D%B0"><span class="nav-number">13.1.</span> <span class="nav-text">加密参数打印</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#CCCrypt"><span class="nav-number">13.1.1.</span> <span class="nav-text">CCCrypt</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#CC-MD5"><span class="nav-number">13.1.2.</span> <span class="nav-text">CC_MD5</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%85%A5%E5%8F%82-%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="nav-number">13.2.</span> <span class="nav-text">修改入参&#x2F;返回值</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%89%93%E5%8D%B0"><span class="nav-number">13.3.</span> <span class="nav-text">打印</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#base64%E7%BC%96%E7%A0%81%E8%A7%A3%E7%A0%81"><span class="nav-number">13.4.</span> <span class="nav-text">base64编码解码</span></a></li></ol></li></ol></div>
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">daxun</p>
  <div class="site-description" itemprop="description">简单记录下</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
        
          <span class="site-state-item-count">93</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/10/17/%E9%80%86%E5%90%91-Frida/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="daxun">
      <meta itemprop="description" content="简单记录下">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-10-17 09:01:44" itemprop="dateCreated datePublished" datetime="2022-10-17T09:01:44+08:00">2022-10-17</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2023-05-19 11:37:45" itemprop="dateModified" datetime="2023-05-19T11:37:45+08:00">2023-05-19</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p><a target="_blank" rel="noopener" href="https://frida.re/docs/home/">https://frida.re/docs/home/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.frida.re/docs/javascript-api">https://www.frida.re/docs/javascript-api</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.kanxue.com/article-342.htm">JavaScript API 一</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.kanxue.com/article-414.htm">JavaScript API 二</a></p>
<p><a target="_blank" rel="noopener" href="https://www.dazhuanlan.com/workant/topics/1230751">非越狱环境使用Frida</a>   </p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/86c1ca71e73a">Frida集成到iOS项目</a></p>
<p><a target="_blank" rel="noopener" href="https://codeshare.frida.re/">https://codeshare.frida.re/</a> 中其它共享的脚本， <code>$ frida --codeshare 脚本路径 -f YOUR_BINARY </code> 将其加载进来</p>
<p>Frida 跨平台的轻量级 Hook 框架，基于Python和JavaScript</p>
<p>使用 Frida 可以获取进程详细信息、拦截和调用指定函数、注入代码、修改参数、从iOS应用程序中dump类和类方法信息等</p>
<h4 id="Frida-安装"><a href="#Frida-安装" class="headerlink" title="Frida 安装"></a>Frida 安装</h4><ul>
<li>iOS 端</li>
</ul>
<p>Cydia 添加源 <a target="_blank" rel="noopener" href="https://build.frida.re/">https://build.frida.re/</a> 安装 Frida for A12+ devices，最新版本 14.2.13</p>
<ul>
<li>macOS 端</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pip3 install frida</span><br><span class="line">$ sudo pip3 install frida-tools</span><br><span class="line">$ frida --version</span><br><span class="line">#升级</span><br><span class="line">$ sudo pip3 install frida --upgrade</span><br><span class="line">$ sudo pip3 install frida-tools --upgrade</span><br><span class="line"></span><br><span class="line">frida                 16.0.11</span><br><span class="line">frida-tools           12.1.1</span><br></pre></td></tr></table></figure>



<h4 id="Frida"><a href="#Frida" class="headerlink" title="Frida"></a>Frida</h4><p>frada-tools 里面还提供了五个使用工具：frida-discover、frida-kill、friaa-ls-devices、frida-ps 以及 frida-trace</p>
<p><code>.bash_profile</code> 添加环境变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export frida-discover&#x3D;&#39;&#x2F;Library&#x2F;Frameworks&#x2F;Python.framework&#x2F;Versions&#x2F;3.8&#x2F;bin&#x2F;frida-discover&#39;</span><br><span class="line">export frida-kill&#x3D;&#39;&#x2F;Library&#x2F;Frameworks&#x2F;Python.framework&#x2F;Versions&#x2F;3.8&#x2F;bin&#x2F;frida-kill&#39;</span><br><span class="line">export frida-trace&#x3D;&#39;&#x2F;Library&#x2F;Frameworks&#x2F;Python.framework&#x2F;Versions&#x2F;3.8&#x2F;bin&#x2F;frida-trace&#39;</span><br><span class="line">export frida-ps&#x3D;&#39;&#x2F;Library&#x2F;Frameworks&#x2F;Python.framework&#x2F;Versions&#x2F;3.8&#x2F;bin&#x2F;frida-ps&#39;</span><br><span class="line">export frida-ls-devices&#x3D;&#39;&#x2F;Library&#x2F;Frameworks&#x2F;Python.framework&#x2F;Versions&#x2F;3.8&#x2F;bin&#x2F;frida-ls-devices&#39;</span><br></pre></td></tr></table></figure>

<p>这些工具都是基于 Frida 的 Python 接口实现的</p>
<p>使用帮助 <a target="_blank" rel="noopener" href="https://frida.re/docs/home/">https://frida.re/docs/home/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ which frida</span><br><span class="line">&#x2F;Library&#x2F;Frameworks&#x2F;Python.framework&#x2F;Versions&#x2F;3.8&#x2F;bin&#x2F;frida</span><br></pre></td></tr></table></figure>

<h5 id="frida-ls-device"><a href="#frida-ls-device" class="headerlink" title="frida-ls-device"></a>frida-ls-device</h5><p>获取可用设备列表，frida-ls-devices 获取到 id 之后就可以在 frida-ps 等工具中使用了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ frida-ls-devices</span><br><span class="line">Id                                        Type    Name</span><br><span class="line">----------------------------------------  ------  ------------</span><br><span class="line">local                                     local   Local System</span><br><span class="line">4ce52917e9a0932f3c821e2418a03d2a993c5650  usb     iPhone</span><br><span class="line">socket                                    remote  Local Socket</span><br></pre></td></tr></table></figure>

<h5 id="frida-ps"><a href="#frida-ps" class="headerlink" title="frida-ps"></a>frida-ps</h5><p>获取设备进程列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ frida-ps -h</span><br><span class="line">-U（--usb）	   连接到USB设备</span><br><span class="line">-D (--device) 如果有多个USB设备，可以用该选项指定设备UDID</span><br><span class="line">-R (--remote) 连接到远程frida-server，connect to remote frida-server</span><br><span class="line">-H (--host)   连接到远程frida-server，主要用于远程调试，connect to remote frida-server on Host</span><br><span class="line">-a（--applications）仅显示正在运行的应用</span><br><span class="line">-i（--installed）   显示所有已安装的应用</span><br><span class="line">-j（--json） 				输出JSON</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#连接到设备查看进程列表</span><br><span class="line">$ frida-ps -U </span><br><span class="line"> 845      ASPCarryLog</span><br><span class="line">1032      AppNotification</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">#连接到设备查看正在运行的应用</span><br><span class="line">$ frida-ps -U -a</span><br><span class="line">或者</span><br><span class="line">$ frida-ps -Ua</span><br><span class="line"></span><br><span class="line">#指定查看某个设备</span><br><span class="line">$ frida-ps -D 00008030-001C19C12281802E -a</span><br><span class="line"></span><br><span class="line">#查看所有安装的应用</span><br><span class="line">$ frida-ps -U -a -i</span><br><span class="line">$ frida-ps -Uai</span><br></pre></td></tr></table></figure>

<h5 id="frida-kill"><a href="#frida-kill" class="headerlink" title="frida-kill"></a>frida-kill</h5><p>结束设备上某个进程，指定应用名称或PID</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ frida-kill -U &lt;PID&gt;&#x2F;&lt;Name&gt;</span><br><span class="line">$ frida-kill -D &lt;DEVICE-ID&gt; &lt;PID&gt;&#x2F;&lt;Name&gt;</span><br><span class="line"></span><br><span class="line">$ frida-kill -U 2441</span><br><span class="line">$ frida-kill -U 微信</span><br></pre></td></tr></table></figure>

<h4 id="frida-trace"><a href="#frida-trace" class="headerlink" title="frida-trace"></a>frida-trace</h4><p>跟踪函数或者方法调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ frida-trace -h</span><br><span class="line">-f 程序包名：frida-trace -U -f com.xx.xx</span><br><span class="line">-F：当前正在运行的程序 frida-trace -U -F 或者 frida-trace -UF 再加其它参数</span><br><span class="line">-o：日志输出到文件</span><br><span class="line"></span><br><span class="line">-i 包含某个c函数</span><br><span class="line">-x 不包含某个c函数</span><br><span class="line">-I 包含模块</span><br><span class="line">-X 排除模块</span><br><span class="line">-m 包含某个OC方法</span><br><span class="line">-M 不包含某个OC方法</span><br><span class="line">-a 跟踪偏移地址</span><br></pre></td></tr></table></figure>

<h5 id="跟踪函数调用"><a href="#跟踪函数调用" class="headerlink" title="跟踪函数调用"></a>跟踪函数调用</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ frida-trace -U -i compress -i &quot;recv*&quot; -x &quot;recvmsg*&quot; -x recvfrom 微信</span><br><span class="line"></span><br><span class="line">跟踪名为compress的函数和recv开头的函数</span><br><span class="line">排除recvmsg开头的函数和名为recvfrom的函数，模糊匹配内容要用双引号</span><br><span class="line"></span><br><span class="line">-i 表示包含某个函数</span><br><span class="line">-x 表示排查某个函数，都支持模糊匹配，可以组合使用</span><br><span class="line">命令执行后会生成基本JS文件，仅输出一些日志，开发者可以根据需要修改它们</span><br></pre></td></tr></table></figure>

<p>上面是附加到目标进程再操作，如果要强制启动进程进行跟踪，可以使用 -f 选项加上 BundleID</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#spawn冷启动</span><br><span class="line">$ frida-trace -U -f com.tencent.xin -i compress -i &quot;recv*&quot; -x &quot;recvmsg*&quot; -x recvfrom</span><br><span class="line"></span><br><span class="line">#-F 当前正在运行的程序（attach热启动）</span><br><span class="line">$ frida-trace -UF -i compress -i &quot;recv*&quot; -x &quot;recvmsg*&quot; -x recvfrom</span><br></pre></td></tr></table></figure>

<p>跟踪后，在当前目录会生成一个<code> __handlers__</code> 文件夹，里面就是 frida-trace 自动生成的 js 脚本文件</p>
<img src="逆向-Frida/frida-trace.png" alt="frida-trace" style="zoom:80%;" />

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//跟踪函数调用后会生成对应跟踪函数的 js 文件</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="title">onEnter</span>(<span class="params">log, args, state</span>)</span> &#123;</span><br><span class="line">    log(<span class="string">`+[LCdes encryptUseDES:<span class="subst">$&#123;args[<span class="number">2</span>]&#125;</span> key:<span class="subst">$&#123;args[<span class="number">3</span>]&#125;</span>]`</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">onLeave</span>(<span class="params">log, retval, state</span>)</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>frida-trace 启动时不会覆盖已有脚本文件，所以可以随时修改这些 JS 文件来添加自己的功能</p>
<h5 id="跟踪OC方法调用"><a href="#跟踪OC方法调用" class="headerlink" title="跟踪OC方法调用"></a>跟踪OC方法调用</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ frida-trace -U -m &quot;-[BaseMsgContentLogicController Send*]&quot; -M &quot;-[BaseMsgContentLogicController SendNotGameEmoticonMessage:errorMsg:]&quot; 微信</span><br><span class="line"></span><br><span class="line"># -m 表示包含某个方法</span><br><span class="line"># -M 表示排除某个方法</span><br><span class="line"># 支持模糊匹配，可以组合使用</span><br></pre></td></tr></table></figure>

<h5 id="跟踪导出函数"><a href="#跟踪导出函数" class="headerlink" title="跟踪导出函数"></a>跟踪导出函数</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ frida-trace -U -I mars -I libxml2.2.dylib -I &quot;MM*&quot; -X MMCommon 微信</span><br><span class="line"></span><br><span class="line">#跟踪主程序的所有导出函数</span><br><span class="line">$ frida-trace -U -I WeChat 微信</span><br><span class="line"></span><br><span class="line">-I 表示包含某个模块</span><br><span class="line">-X 表示排除某个模块，支持模糊匹配，可以混合使用</span><br></pre></td></tr></table></figure>

<h5 id="跟踪导入函数"><a href="#跟踪导入函数" class="headerlink" title="跟踪导入函数"></a>跟踪导入函数</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ frida-trace -U -t CoureFoundation 微信</span><br><span class="line"></span><br><span class="line">#跟踪主程序所有导入函数</span><br><span class="line">$ frida-trace -U -T 微信</span><br><span class="line"></span><br><span class="line">-t 表示包含某个模块</span><br><span class="line">-T 表示包含主程序</span><br></pre></td></tr></table></figure>

<h5 id="跟踪偏移地址"><a href="#跟踪偏移地址" class="headerlink" title="跟踪偏移地址"></a>跟踪偏移地址</h5><p>-a 添加模块内偏移地址的监控，”MODULE!OFFSET“</p>
<p>由于 macOS 终端会把 ！转义，所以需要输入 <code>\!</code> 才能正常使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#对Aweme模块中偏移地址为0x2A65CCC的函数进行追踪</span><br><span class="line">$ frida-trace -U -f com.ss.iphone.ugc.Aweme -a Aweme\!2A65CCC</span><br></pre></td></tr></table></figure>

<h5 id="跟踪调用栈"><a href="#跟踪调用栈" class="headerlink" title="跟踪调用栈"></a>跟踪调用栈</h5><p>利用 Frida 可以非常方便跟踪某个方法的调用栈，只需要在 JS 里面添加下面代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log(<span class="string">&#x27;\tBacktrace:\n\t&#x27;</span> + Thread.backtrace(<span class="built_in">this</span>.context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join(<span class="string">&#x27;\n\t&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h4 id="进入交互模式"><a href="#进入交互模式" class="headerlink" title="进入交互模式"></a>进入交互模式</h4><p>进入交互模式两种方法</p>
<ul>
<li>通过应用名或PID附加</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ frida -U 微信</span><br><span class="line">$ frida -U -p PID</span><br><span class="line">$ frida -UF 附加到当前正在运行的程序</span><br></pre></td></tr></table></figure>

<ul>
<li>直接启动进程</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ frida -U -f com.tencent.xin</span><br><span class="line"></span><br><span class="line">#或者不中断应用程序启动</span><br><span class="line">$ frida -U -f com.tencent.xin --no-pause</span><br></pre></td></tr></table></figure>

<ul>
<li>报错 </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Failed to attach: need Gadget to attach on jailed iOS; its default location is: &#x2F;Users&#x2F;xx&#x2F;.cache&#x2F;frida&#x2F;gadget-ios.dylib</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;github.com&#x2F;frida&#x2F;frida&#x2F;releases&#x2F; 下载对应版本的Gadget</span><br><span class="line">frida-gadget-16.0.11-ios-universal.dylib.gz</span><br><span class="line">$ gunzip frida-gadget-16.0.11-ios-universal.dylib.gz</span><br><span class="line">$ mkdir -p ~&#x2F;.cache&#x2F;frida</span><br><span class="line">$ cp frida-gadget-16.0.11-ios-universal.dylib ~&#x2F;.cache&#x2F;frida&#x2F;gadget-ios.dylib</span><br></pre></td></tr></table></figure>

<p>进入交互模式后就可以访问目标进程的所有属性、方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#打印视图层级</span><br><span class="line">-&gt; w &#x3D; ObjC.classes.UIWindow.keyWindow()</span><br><span class="line">-&gt; desc &#x3D; w.recursiveDescription().toString()</span><br><span class="line"></span><br><span class="line">#打印APP安装路径</span><br><span class="line">-&gt; ObjC.classes[&quot;TestViewController&quot;].$moduleName;</span><br><span class="line"></span><br><span class="line">#打印类的所有方法</span><br><span class="line">-&gt; ObjC.classes[&quot;TestViewController&quot;].$ownMethods</span><br><span class="line"></span><br><span class="line">#类方法包含父类</span><br><span class="line">-&gt; ObjC.classes[&quot;TestViewController&quot;].$methods</span><br></pre></td></tr></table></figure>



<h5 id="加载脚本"><a href="#加载脚本" class="headerlink" title="加载脚本"></a>加载脚本</h5><p>越狱英文名 JailBroke 或 JailBreak，使用关键词 jail 对当前进程的所有类及方法进行检索。</p>
<p>Frida 提供的 JavaScript API 里面，由 <code>ObjC.classes</code> 能得到当前应用中所有已经注册的类，对它进行遍历就可以得到符合要求的类名</p>
<p>写一段JS代码</p>
<p><code>ObjC.classes.XXXClass.$methods</code> 就可以得到 XXXClass 类的所有方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//筛选符合要求的类及方法</span></span><br><span class="line"><span class="keyword">if</span> (ObjC.available) &#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> className <span class="keyword">in</span> ObjC.classes) &#123;</span><br><span class="line">		<span class="keyword">if</span> (className.toLowerCase().indexOf(<span class="string">&#x27;jail&#x27;</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="built_in">console</span>.log(<span class="string">&#x27;[#]ClassName--------&gt;&#x27;</span> + className)</span><br><span class="line"></span><br><span class="line">			<span class="keyword">var</span> methods = <span class="built_in">eval</span>(<span class="string">&#x27;ObjC.classes.&#x27;</span> + className + <span class="string">&#x27;.$methods&#x27;</span>) <span class="comment">//类中所有方法</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; methods.length; i++) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					<span class="keyword">if</span> (methods[i].toLowerCase().indexOf(<span class="string">&#x27;jail&#x27;</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">						<span class="built_in">console</span>.log(<span class="string">&#x27;[-]&#x27;</span> + methods[i])</span><br><span class="line">					&#125;</span><br><span class="line">				&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">					<span class="built_in">console</span>.log(<span class="string">&#x27;[!] Exception:&#x27;</span> + err.message)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>两种方法加载脚本</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#-l 选项加载脚本</span><br><span class="line">$ frida -U -l WeChat.js 微信</span><br><span class="line"></span><br><span class="line">#或者</span><br><span class="line">#进入交互界面后使用%load 手动加载脚本</span><br><span class="line">[iPhone::微信]-&gt; %load path&#x2F;to&#x2F;WeChat.js</span><br><span class="line"></span><br><span class="line">#结果</span><br><span class="line">Attaching...</span><br><span class="line">[#]ClassName--------&gt;JailBreakHelper</span><br><span class="line">[-]+ getJailbreakRootDir</span><br><span class="line">[-]+ getJailbreakPath</span><br><span class="line">[-]+ JailBroken</span><br><span class="line">[-]- IsJailBreak</span><br><span class="line">[-]- HasInstallJailbreakPlugin:</span><br></pre></td></tr></table></figure>

<p>从输出信息可以看到一个 JailBreakHelper 类</p>
<h4 id="拦截器Interceptor"><a href="#拦截器Interceptor" class="headerlink" title="拦截器Interceptor"></a>拦截器Interceptor</h4><p>Frida 提供的 JavaScript API 里面有一个 <code>Interceptor</code> 拦截器，将它附加到某个函数后，可以在调用前和调用后分别进行拦截，以获取函数的参数和返回值</p>
<h5 id="attach拦截C函数"><a href="#attach拦截C函数" class="headerlink" title="attach拦截C函数"></a>attach拦截C函数</h5><p>Hook 下 fopen，fopen 的原型：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用给定的模式 mode 打开 filename 指向的文件，如果成功打开文件，则返回一个指针，相当于句柄，打开失败返回0</span></span><br><span class="line"></span><br><span class="line">FILE *fopen(<span class="keyword">const</span> <span class="keyword">char</span> *filename, <span class="keyword">const</span> <span class="keyword">char</span> *mode);</span><br></pre></td></tr></table></figure>

<p>fopen.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Interceptor.attach(Module.findExportByName(<span class="literal">null</span>, <span class="string">&quot;fopen&quot;</span>), &#123;</span><br><span class="line">  onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(args[<span class="number">0</span>].isNull()) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">var</span> path = args[<span class="number">0</span>].readUtf8String();<span class="comment">//读取char*</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;fopen: &quot;</span> + path);</span><br><span class="line">  &#125;,</span><br><span class="line">  onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;\t[-]Type of return value:&quot;</span> + <span class="keyword">typeof</span>(retval));</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;\t[-]Original return value:&quot;</span> + retval);</span><br><span class="line">    retval.replace(<span class="number">0</span>);  <span class="comment">//将返回值替换成0</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;\t[-]New return value&quot;</span> + retval);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># -l 加载指定脚本文件</span><br><span class="line">$ frida -U -l fopen.js xxxx  </span><br></pre></td></tr></table></figure>

<h5 id="attach拦截-OC方法"><a href="#attach拦截-OC方法" class="headerlink" title="attach拦截 OC方法"></a>attach拦截 OC方法</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (ObjC.available) &#123; <span class="comment">//判断Object-C类方法是否已经加载进来</span></span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="keyword">var</span> className = <span class="string">&#x27;JailBreakHelper&#x27;</span>;</span><br><span class="line">		<span class="keyword">var</span> methodNames = [<span class="string">&#x27;+ JailBroken&#x27;</span>, <span class="string">&#x27;- IsJailBreak&#x27;</span>];</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">var</span> index <span class="keyword">in</span> methodNames) &#123;</span><br><span class="line">			<span class="keyword">var</span> methodName = methodNames[index];</span><br><span class="line">			<span class="keyword">var</span> hook = <span class="built_in">eval</span>(<span class="string">&#x27;ObjC.classes.&#x27;</span> + className + <span class="string">&#x27;[&quot;&#x27;</span> + methodName + <span class="string">&#x27;&quot;]&#x27;</span>);</span><br><span class="line">			<span class="comment">//或者 var hook = ObjC.classes[class_name][method_name] 这种写法比较清楚</span></span><br><span class="line">      </span><br><span class="line">			Interceptor.attach(hook.implementation,&#123;</span><br><span class="line">				onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">					<span class="built_in">console</span>.log(<span class="string">&#x27;===onEnter===&#x27;</span>);</span><br><span class="line">					<span class="built_in">console</span>.log(<span class="string">&#x27;className:&#x27;</span> + className);</span><br><span class="line">					<span class="built_in">console</span>.log(<span class="string">&#x27;Method Name:&#x27;</span> + methodName);</span><br><span class="line">					<span class="built_in">console</span>.log(<span class="string">&#x27;======&#x27;</span>);</span><br><span class="line">				&#125;,</span><br><span class="line">				onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>) </span>&#123;</span><br><span class="line">					<span class="built_in">console</span>.log(<span class="string">&#x27;===onLeave===&#x27;</span>);</span><br><span class="line">					<span class="built_in">console</span>.log(<span class="string">&#x27;className:&#x27;</span> + className);</span><br><span class="line">					<span class="built_in">console</span>.log(<span class="string">&#x27;Method Name:&#x27;</span> + methodName);</span><br><span class="line">					<span class="built_in">console</span>.log(<span class="string">&#x27;\t[-] Return Value:&#x27;</span> + retval);</span><br><span class="line">					<span class="built_in">console</span>.log(<span class="string">&#x27;======&#x27;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">&#x27;[!] Exception:&#x27;</span> + err.message);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>点击微信的支付处方方法，打印结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;onEnter&#x3D;&#x3D;&#x3D;</span><br><span class="line">className:JailBreakHelper</span><br><span class="line">Method Name:- IsJailBreak</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;onLeave&#x3D;&#x3D;&#x3D;</span><br><span class="line">className:JailBreakHelper</span><br><span class="line">Method Name:- IsJailBreak</span><br><span class="line">        [-] Return Value:0x1</span><br></pre></td></tr></table></figure>

<p>onEnter 和 onLeave 是两个回调函数，分别处理原始方法调用前和后的逻辑。</p>
<p>Frida 支持脚本热更新，当 JS 文件被修改并保存后，能够实时生效</p>
<p>修改脚本将返回值改成NO</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (ObjC.available) &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		Interceptor.attach(ObjC.classes.JailBreakHelper[<span class="string">&#x27;- IsJailBreak&#x27;</span>].implementation, &#123;</span><br><span class="line">			onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>) </span>&#123;</span><br><span class="line">				<span class="built_in">console</span>.log(<span class="string">&#x27;return = NO&#x27;</span>);</span><br><span class="line">				retval.replace(ptr(<span class="number">0x0</span>));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">&#x27;[!] Exception:&#x27;</span> + err.message);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="拦截自定义函数"><a href="#拦截自定义函数" class="headerlink" title="拦截自定义函数"></a>拦截自定义函数</h5><p>除了拦截系统库自带的函数，还可以拦截自定义函数</p>
<p>比如自定义 getStr 函数，返回值是一个字符串指针。我们在 onLeave 函数中新建一个变量 string，为其分配内存并填充字符串 45678，然后用返回值替换变量 string</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Interceptor.attach(Module.findExportByName(<span class="literal">null</span>, <span class="string">&quot;getStr&quot;</span>), &#123;</span><br><span class="line">  onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;getStr&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;\t[-]Type of return value:&quot;</span> + <span class="keyword">typeof</span> retval);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;\t[-]Original return value:&quot;</span> + retval.readUtf8String());</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> string = Memory.allocUtf8String(<span class="string">&quot;45678&quot;</span>); <span class="comment">//分配内存</span></span><br><span class="line">    retval.replace(string);											  <span class="comment">//替换</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;\t[-]New return value&quot;</span> + retval.readUtf8String());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h5 id="replace替换OC方法"><a href="#replace替换OC方法" class="headerlink" title="replace替换OC方法"></a>replace替换OC方法</h5><p>Interceptor.attach() 拦截目标后，可以打印参数、修改返回值，但无法阻止方法的执行</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">Interceptor.replace(target, replacement)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">replacement 是 NativeCallback 类型</span></span><br><span class="line"><span class="comment">new NativeCallback(func, returnType, argTypes[abi]) //函数 返回值 参数</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var target_addr = get_rva(<span class="string">&#x27;XinHuaShe&#x27;</span>, <span class="number">0xBF9A0</span>)</span><br><span class="line"><span class="comment">//NativeCallback(func, returnType, argTypes[,abi])</span></span><br><span class="line"><span class="comment">//或者不用参数</span></span><br><span class="line">Interceptor.replace(ptr(target_addr), new NativeCallback(function(argc, argv)&#123;</span><br><span class="line">  console.log(<span class="string">&#x27;hook sub_ptrace bypass&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;, <span class="keyword">int</span>, [<span class="keyword">int</span>, <span class="keyword">int</span>]))</span><br></pre></td></tr></table></figure>

<h5 id="replace替换C函数"><a href="#replace替换C函数" class="headerlink" title="replace替换C函数"></a>replace替换C函数</h5><p>对于C函数，操作稍微复杂些，需要使用NativeFunction定义原函数与新函数，然后使用 Interceptor.replace() 进行替换</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dlopenPtr = Module.findExportByName(<span class="literal">null</span>, <span class="string">&#x27;dlopen&#x27;</span>)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">原函数</span></span><br><span class="line"><span class="comment">NativeFunction(函数地址，返回值，[参数数组])</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> dlopen = <span class="keyword">new</span> NativeFunction(dlopenPtr, <span class="string">&#x27;pointer&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>, <span class="string">&#x27;int&#x27;</span>])</span><br><span class="line">Interceptor.replace(dlopenPtr, <span class="keyword">new</span> NativeCallBack(<span class="function"><span class="keyword">function</span>(<span class="params">path, mode</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//新函数逻辑</span></span><br><span class="line">  <span class="keyword">var</span> name = Memory.readUtf8String(path)</span><br><span class="line">  <span class="keyword">if</span> (name != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;name:&#x27;</span> + name)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//调用原函数</span></span><br><span class="line">  <span class="keyword">return</span> dlopen(path, mode)</span><br><span class="line">&#125;,<span class="string">&#x27;pointer&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>, <span class="string">&#x27;int&#x27;</span>]))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="implementation方式替换方法"><a href="#implementation方式替换方法" class="headerlink" title="implementation方式替换方法"></a>implementation方式替换方法</h5><p>例如，类ViewController存在一个 update 实例方法</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)update:(<span class="keyword">id</span>)args;</span><br></pre></td></tr></table></figure>

<p>当需要准确知道是否因为这个方法的执行而导致页面发生了变化时，可以将原方法替换掉进行测试</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> update = Objc.classes[<span class="string">&quot;ViewController&quot;</span>][<span class="string">&quot;- update:&quot;</span>]</span><br><span class="line"><span class="comment">//先获取原方法</span></span><br><span class="line"><span class="keyword">var</span> oldImp = update.implementation;</span><br><span class="line">update.implementation = ObjC.implement(update, <span class="function"><span class="keyword">function</span>(<span class="params">handle,selector,args</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> self = ObjC.Object(handle);</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;self:&#x27;</span> + self);</span><br><span class="line">	<span class="comment">//这样原始方法就不会被执行，也就达到了屏蔽的效果</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//如果要调用原方法</span></span><br><span class="line">	oldImp(handle,selector,args);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//didTap 需要传递两个参数 ObjC.implement回调中也需要两个参数</span></span><br><span class="line"><span class="keyword">var</span> didTap = ObjC.classes.T1TranslateButton[<span class="string">&#x27;- _didTap:forEvent:&#x27;</span>]</span><br><span class="line"><span class="keyword">var</span> didTapOldImp = didTap.implementation</span><br><span class="line"></span><br><span class="line"><span class="comment">// 覆盖实现，替换成其它方法</span></span><br><span class="line">didTap.implementation = ObjC.implement(setTitle, <span class="function"><span class="keyword">function</span>(<span class="params">handle, selector, arg1, arg2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> self = ObjC.Object(handle)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;self -- &quot;</span>, self) </span><br><span class="line">  <span class="comment">// 调用旧实现</span></span><br><span class="line">  <span class="comment">// didTapOldImp(handle, selector, arg1, arg2)</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> method = Objc.classes.NSURL[<span class="string">&#x27;+ URLWithString:&#x27;</span>]</span><br><span class="line"><span class="keyword">var</span> origImp = method.implementation;</span><br><span class="line">method.implementation = Objc.implement(method, <span class="function"><span class="keyword">function</span>(<span class="params">self, selector, url</span>)) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> urlString = Objc.Object(url)                                     </span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;url:&#x27;</span> + urlString.toString())</span><br><span class="line">	<span class="keyword">return</span> origImp(self, selector, url)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="保存日志"><a href="#保存日志" class="headerlink" title="保存日志"></a>保存日志</h5><p>有时候拦截函数调用的次数较多，打印信息也较多，需要将结果保存成文件，方便查看</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> file = <span class="keyword">new</span> File(<span class="string">&quot;/var/mobile/log.txt&quot;</span>, <span class="string">&quot;a+&quot;</span>); <span class="comment">//追加内容</span></span><br><span class="line">file.write(<span class="string">&quot;logInfo&quot;</span>);</span><br><span class="line">file.flush();</span><br><span class="line">file.close();</span><br></pre></td></tr></table></figure>

<h4 id="API查找器ApiResolver"><a href="#API查找器ApiResolver" class="headerlink" title="API查找器ApiResolver"></a>API查找器ApiResolver</h4><p>如果需要批量 Hook，如 Hook 某个类中的所有方法；或者某个模块中特定名称的函数 Hook，</p>
<p>API里提供了ApiResolver接口，能够根据正则表达式获取符合条件的所有方法，支持对 OC和C方法进行查找</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var resolver = new ApiResolver(<span class="string">&#x27;objc&#x27;</span>) <span class="comment">//查找OC方法</span></span><br><span class="line">var resolver = new ApiResolver(<span class="string">&#x27;module&#x27;</span>) <span class="comment">//查找C方法</span></span><br></pre></td></tr></table></figure>

<h5 id="查找OC方法"><a href="#查找OC方法" class="headerlink" title="查找OC方法"></a>查找OC方法</h5><p>获取微信红包相关的 WCRedEnvelopesLogicMgr 类的所有方法，JS代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">module</span> = &#123;&#125;</span><br><span class="line"><span class="keyword">var</span> resolver = <span class="keyword">new</span> ApiResolver(<span class="string">&#x27;objc&#x27;</span>);<span class="comment">//创建已加载OC类方法的API查找器</span></span><br><span class="line"><span class="comment">//enumerateMatches 是异步的，也有同步的方法 enumerateMatchesSync</span></span><br><span class="line"><span class="keyword">var</span> matches = resolver.enumerateMatches(<span class="string">&#x27;*[WCRedEnvelopesLogicMgr *]&#x27;</span>, &#123;</span><br><span class="line">  onMatch: <span class="function"><span class="keyword">function</span>(<span class="params">match</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//module.name    = match.name</span></span><br><span class="line">    <span class="comment">//module.address = match.address</span></span><br><span class="line">    <span class="built_in">console</span>.log(match[<span class="string">&#x27;name&#x27;</span>] + <span class="string">&#x27;:&#x27;</span> + match[<span class="string">&#x27;address&#x27;</span>]);</span><br><span class="line">  &#125;,</span><br><span class="line">  onComplete: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//再attach</span></span><br><span class="line">Interceptor.attach(ptr(matches[<span class="number">0</span>][<span class="string">&#x27;address&#x27;</span>]), &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//过滤指定方法，再atach</span></span><br><span class="line">onMatch: <span class="function"><span class="keyword">function</span>(<span class="params">match</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> method = match[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">  <span class="keyword">var</span> implementation = match[<span class="string">&#x27;address&#x27;</span>]</span><br><span class="line">  <span class="function"><span class="title">if</span>(<span class="params">method.indexOf(<span class="string">&#x27;removeItemAtPath&#x27;</span>) != -<span class="number">1</span></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      Interceptor.attach(implementation,&#123;</span><br><span class="line">        ...</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;<span class="function"><span class="title">catch</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;[!]Exception:&#x27;</span> + err.message)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>脚本执行后，将 WCRedEnvelopesLogicMgr 类的所有方法和内存地址都打印出来了</p>
<p>获取所有方法后，可以使用 Interceptor.attach() 对每个方法进行拦截，然后打印参数和返回值</p>
<p>将拦截器中将调用的方法、传入参数及返回值都打印出来，就可以分析调用顺序了</p>
<h5 id="绕过AFNetworking证书校验"><a href="#绕过AFNetworking证书校验" class="headerlink" title="绕过AFNetworking证书校验"></a>绕过AFNetworking证书校验</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> resolver = <span class="keyword">new</span> ApiResolver(<span class="string">&#x27;objc&#x27;</span>);<span class="comment">//创建已加载Object-C类方法的API查找器</span></span><br><span class="line">	<span class="keyword">var</span> matches = resolver.enumerateMatchesSync(<span class="string">&quot;-[AFSecurityPolicy evaluateServerTrust:forDomain:]&quot;</span>);<span class="comment">//查找evaluateServerTrust:forDomain函数，返回数组类型</span></span><br><span class="line">	<span class="keyword">if</span> (matches.lenght == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">&quot;\n[E] -[AFSecurityPolicy evaluateServerTrust:forDomain:] is not found!\n&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	Interceptor.attach(ptr(matches[<span class="number">0</span>][<span class="string">&quot;address&quot;</span>]),&#123;</span><br><span class="line">			onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>) </span>&#123;</span><br><span class="line">				<span class="built_in">console</span>.log(<span class="string">&quot;[I] -[AFSecurityPolicy evaluateServerTrust:forDomain:] hits!&quot;</span>);</span><br><span class="line">				retval.replace(<span class="number">1</span>);<span class="comment">//将返回值修改为1</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	);</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&quot;[I] -[AFSecurityPolicy evaluateServerTrust:forDomain:] is hooked!\n&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main();</span><br></pre></td></tr></table></figure>

<h5 id="查找C方法"><a href="#查找C方法" class="headerlink" title="查找C方法"></a>查找C方法</h5><p>API 如何查找 C 函数的，有3种方式</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">exports:*!open*       <span class="comment">//查找某一个C函数，eg:查找open函数</span></span><br><span class="line">exports:libc.so!	    <span class="comment">//查找某一个动态库里的所有函数，eg:查找libc.so中所有函数</span></span><br><span class="line">imports:notepad.exe!  <span class="comment">//查找某一个模块里的所有函数，eg:查找notepad.exe中的所有函数</span></span><br><span class="line">exports:libSystem.B.dylib!CCCrypt</span><br><span class="line">exports:*!open*</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> resolver = <span class="keyword">new</span> ApiResolver(<span class="string">&#x27;module&#x27;</span>);</span><br><span class="line">resolver.enumerateMatches(<span class="string">&#x27;exports:*fopen*&#x27;</span>,&#123;</span><br><span class="line">  onMatch: <span class="function"><span class="keyword">function</span>(<span class="params">match</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name = match[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="keyword">var</span> address = match[<span class="string">&#x27;address&#x27;</span>];</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h4 id="JS脚本"><a href="#JS脚本" class="headerlink" title="JS脚本"></a>JS脚本</h4><h5 id="打印OC参数"><a href="#打印OC参数" class="headerlink" title="打印OC参数"></a>打印OC参数</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;0--: &#x27;</span> + ObjC.Object(args[<span class="number">0</span>]).toString())</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;arg[2] -&gt;&quot;</span> + <span class="keyword">new</span> ObjC.Object(args[<span class="number">2</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment">//数组参数</span></span><br><span class="line">onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> obj = ObjC.Object(args[<span class="number">3</span>])</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; obj.count(); i++)</span><br><span class="line">    <span class="built_in">console</span>.log(ObjC.Object(obj.objectAtIndex_(i)).$class)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果变量类型不确定，可以使用如下代码确定类型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;Type of args[2] -&gt; &quot;</span> + <span class="keyword">new</span> ObjC.Object(args[<span class="number">2</span>]).$className)</span><br></pre></td></tr></table></figure>



<h5 id="常用脚本"><a href="#常用脚本" class="headerlink" title="常用脚本"></a>常用脚本</h5><h6 id="枚举所有类"><a href="#枚举所有类" class="headerlink" title="枚举所有类"></a>枚举所有类</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> className <span class="keyword">in</span> ObjC.classes) &#123;</span><br><span class="line">  <span class="keyword">if</span> (ObjC.classes.hasOwnProperty(className)) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(className);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="枚举一个类的所有method"><a href="#枚举一个类的所有method" class="headerlink" title="枚举一个类的所有method"></a>枚举一个类的所有method</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (ObjC.available) &#123;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">      <span class="keyword">var</span> className = <span class="string">&quot;NSURL&quot;</span>;</span><br><span class="line">      <span class="keyword">var</span> methods = <span class="built_in">eval</span>(<span class="string">&#x27;ObjC.classes.&#x27;</span> + className + <span class="string">&#x27;.$methods&#x27;</span>); <span class="comment">//一个类的所有方法</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; methods.length; i++) &#123;</span><br><span class="line">          <span class="keyword">try</span></span><br><span class="line">          &#123;</span><br><span class="line">              <span class="keyword">if</span> (methods[i].indexOf(<span class="string">&quot;fileURLWithPath&quot;</span>) &gt; -<span class="number">1</span>)</span><br><span class="line">              <span class="built_in">console</span>.log(<span class="string">&quot;[-] &quot;</span>+methods[i]);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="function"><span class="title">catch</span>(<span class="params">err</span>)</span> &#123;</span><br><span class="line">              <span class="built_in">console</span>.log(<span class="string">&quot;[!] Exception1: &quot;</span> + err.message);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">catch</span>(<span class="params">err</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;[!] Exception2: &quot;</span> + err.message);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#也可以进入交互模式后通过 $ownMethods 打印</span><br><span class="line"></span><br><span class="line">$ frida -U FridaDemo --no-pause</span><br><span class="line">-&gt; ObjC.classes[&quot;ViewController&quot;].$ownMethods</span><br></pre></td></tr></table></figure>



<h6 id="打印调用栈"><a href="#打印调用栈" class="headerlink" title="打印调用栈"></a>打印调用栈</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  onEnter: <span class="function"><span class="keyword">function</span> (<span class="params">log, args, state</span>) </span>&#123;</span><br><span class="line">    log(<span class="string">&#x27;\tBacktrace:\n\t&#x27;</span> + Thread.backtrace(<span class="built_in">this</span>.context,Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join(<span class="string">&#x27;\n\t&#x27;</span>));</span><br><span class="line">  &#125;,</span><br><span class="line">  onLeave: <span class="function"><span class="keyword">function</span> (<span class="params">log, retval, state</span>) </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="hook-一个method"><a href="#hook-一个method" class="headerlink" title="hook 一个method"></a>hook 一个method</h6><blockquote>
<p>打印参数注意</p>
<p>args[0]：self</p>
<p>args[1]：The selector (openURL:)</p>
<p>args[2]：The first param</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (ObjC.available)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> className = <span class="string">&quot;JailbreakDetectionVC&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> funcName = <span class="string">&quot;- isJailbroken&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> hook = <span class="built_in">eval</span>(<span class="string">&#x27;ObjC.classes.&#x27;</span> + className + <span class="string">&#x27;[&quot;&#x27;</span> + funcName + <span class="string">&#x27;&quot;]&#x27;</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;[*] Class Name: &quot;</span> + className);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;[*] Method Name: &quot;</span> + funcName);</span><br><span class="line">        Interceptor.attach(hook.implementation, &#123;</span><br><span class="line">          onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;aaaa&quot;</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;param:&quot;</span>+args[<span class="number">2</span>]+<span class="string">&quot; type:&quot;</span>+<span class="keyword">typeof</span> args[<span class="number">2</span>]);</span><br><span class="line">          &#125;,</span><br><span class="line">          onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;Return value-&gt; (type:&quot;</span>+<span class="keyword">typeof</span> retval+<span class="string">&quot;,value:&quot;</span>+retval+<span class="string">&quot;)&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//修改返回值</span></span><br><span class="line">            newretval = ptr(<span class="string">&quot;0x0&quot;</span>)</span><br><span class="line">            retval.replace(newretval)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(err)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;[!] Exception2: &quot;</span> + err.message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="hook带block方法"><a href="#hook带block方法" class="headerlink" title="hook带block方法"></a>hook带block方法</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数类型为NSStackBlock</span></span><br><span class="line"><span class="keyword">let</span> method = <span class="string">&#x27;+ autoLogin:session:callBack:&#x27;</span></span><br><span class="line"><span class="keyword">let</span> impl = ObjC.classes.ALBBSessionRpcService[method]</span><br><span class="line"><span class="keyword">const</span> oldImpl = impl.implementation;</span><br><span class="line">impl.implementation = ObjC.implement(impl, <span class="function"><span class="keyword">function</span>(<span class="params">self,selector,arg1,arg2,arg3</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;arg1&quot;</span>,<span class="keyword">new</span> ObjC.Object(arg1))</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;arg2&quot;</span>,arg2,<span class="built_in">JSON</span>.stringify(<span class="keyword">new</span> ObjC.Object(arg2)))</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;arg3&quot;</span>,arg3,<span class="keyword">new</span> ObjC.Object(arg3)) <span class="comment">//此参数为NSStackBlock</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> block = <span class="keyword">new</span> ObjC.Block(arg3);</span><br><span class="line">    <span class="keyword">const</span> appCallback = block.implementation;</span><br><span class="line">    block.implementation = <span class="function"><span class="keyword">function</span> (<span class="params">resp</span>)  </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(resp) <span class="comment">// ALBBResponse</span></span><br><span class="line">        <span class="keyword">const</span> result = appCallback(resp);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ret = oldImpl(self,selector,arg1,arg2,arg3);</span><br><span class="line">    <span class="comment">// console.log(ret)</span></span><br><span class="line">  &#125;<span class="function"><span class="title">catch</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ret</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h6 id="设置属性"><a href="#设置属性" class="headerlink" title="设置属性"></a>设置属性</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = ObjC.classes.ALBBRPCInfo[<span class="string">&#x27;new&#x27;</span>]()</span><br><span class="line">obj.token()； <span class="comment">// 获取属性</span></span><br><span class="line">obj[<span class="string">&#x27;setToken:&#x27;</span>](<span class="string">&#x27;token值&#x27;</span>) <span class="comment">// 设置属性</span></span><br></pre></td></tr></table></figure>



<h6 id="加载任一动态库"><a href="#加载任一动态库" class="headerlink" title="加载任一动态库"></a>加载任一动态库</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadDylib</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> dlopen = <span class="keyword">new</span> NativeFunction(Module.findExportByName(<span class="literal">null</span>,<span class="string">&#x27;dlopen&#x27;</span>),<span class="string">&#x27;pointer&#x27;</span>,[<span class="string">&#x27;pointer&#x27;</span>,<span class="string">&#x27;int&#x27;</span>]);</span><br><span class="line">  <span class="keyword">var</span> path = Memory.allocUtf8String(<span class="string">&#x27;/usr/lib.test.dylib&#x27;</span>)</span><br><span class="line">  dlopen(path,<span class="number">10</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="获取当前进程所有模块"><a href="#获取当前进程所有模块" class="headerlink" title="获取当前进程所有模块"></a>获取当前进程所有模块</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取当前进程所有模块</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getModuleList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  Process.emumerateModules(&#123;</span><br><span class="line">    onMatch: <span class="function"><span class="keyword">function</span>(<span class="params"><span class="built_in">module</span></span>)</span>&#123;</span><br><span class="line">    	<span class="built_in">console</span>.log(<span class="string">&#x27;Module name:&#x27;</span> + <span class="built_in">module</span>.name)<span class="comment">//模块名称</span></span><br><span class="line">  	  <span class="built_in">console</span>.log(<span class="string">&#x27;Module base:&#x27;</span> + <span class="built_in">module</span>.base)<span class="comment">//模块基址</span></span><br><span class="line">  		<span class="built_in">console</span>.log(<span class="string">&#x27;Module size:&#x27;</span> + <span class="built_in">module</span>.size)<span class="comment">//模块大小</span></span><br><span class="line">  		<span class="built_in">console</span>.log(<span class="string">&#x27;Module path:&#x27;</span> + <span class="built_in">module</span>.path)<span class="comment">//模块路径</span></span><br><span class="line">  	&#125;,</span><br><span class="line">  	onComplete: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  		<span class="built_in">console</span>.log(<span class="string">&quot;complete&quot;</span>)</span><br><span class="line">  	&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//报错了。。</span></span><br></pre></td></tr></table></figure>

<h6 id="其它方法"><a href="#其它方法" class="headerlink" title="其它方法"></a>其它方法</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">Module模块</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">moduleName：lib名字</span></span><br><span class="line"><span class="comment">exportName：函数名字</span></span><br><span class="line"><span class="comment">返回: exportName的地址</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Module.findExportByName(moduleName|<span class="literal">null</span>, exportName)</span><br><span class="line">Module.getExportByName(moduleName|<span class="literal">null</span>, exportName)</span><br><span class="line">区别：</span><br><span class="line">没有找到 getExportByName 会抛出异常，findExportByName返回<span class="literal">null</span></span><br><span class="line">	</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">moduleName：lib名字</span></span><br><span class="line"><span class="comment">返回: lib的基地址</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Module.findBaseAddress(moduleName)</span><br><span class="line">	</span><br><span class="line">Process模块</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">address：lib的指针地址</span></span><br><span class="line"><span class="comment">返回: 一个Module对象</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Process.findModuleByAddress(address)</span><br><span class="line">	</span><br><span class="line">Momery模块</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">pointer:指针地址</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Memory.readCString(pointer)</span><br><span class="line"></span><br><span class="line"><span class="comment">//把pointer还原成字符串</span></span><br><span class="line">Memory.readUtf8String(pointer);</span><br><span class="line">Memory.readAnsiString(pointer)</span><br><span class="line">Memory.allocUtf8String(<span class="string">&quot;a&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建NSString</span></span><br><span class="line"><span class="keyword">let</span> arg1 = ObjC.classes.NSString[<span class="string">&#x27;alloc&#x27;</span>]()[<span class="string">&#x27;initWithString:&#x27;</span>](<span class="string">&#x27;我的字符串参数&#x27;</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment">//创建block</span></span><br><span class="line"><span class="keyword">const</span> pendingBlocks = <span class="keyword">new</span> <span class="built_in">Set</span>();</span><br><span class="line"><span class="keyword">let</span> newReplyBlock = <span class="keyword">new</span> ObjC.Block(&#123;</span><br><span class="line">    <span class="comment">// 类型签名，可以通过hook指定方法的block参数打印new ObjC.Block(resultCallback).types</span></span><br><span class="line">    types:<span class="string">&#x27;v12@?0B8&#x27;</span>, </span><br><span class="line">    implementation: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          pendingBlocks.delete(newReplyBlock);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取指定类型签名</span></span><br><span class="line">ObjC.classes.Foo[<span class="string">&#x27;- connection:didReceiveResponse:&#x27;</span>].types</span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"><span class="keyword">new</span> ObjC.Block(resultCallback).types</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//对象参数列表</span></span><br><span class="line">obj.$ivars</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@interface ALBBSessionModel : NSObject</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">+ (id)getUserId;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> userid = <span class="keyword">new</span> ObjC.Object(ObjC.classes.ALBBSessionModel[<span class="string">&#x27;+ getUserId&#x27;</span>]())</span><br><span class="line"></span><br><span class="line">@interface JDYLoginCenterProtocolIMP : NSObject &lt;JDYLoginCenterProtocol, JDYILoginService&gt;</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)fastSwitchUserWithUserId:(id)arg1 resultCallback:(CDUnknownBlockType)arg2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> userid = ObjC.classes.NSString[<span class="string">&#x27;alloc&#x27;</span>]()[<span class="string">&#x27;initWithString:&#x27;</span>](<span class="string">&#x27;3109007973&#x27;</span>) </span><br><span class="line"><span class="keyword">const</span> pendingBlocks = <span class="keyword">new</span> <span class="built_in">Set</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> newReplyBlock = <span class="keyword">new</span> ObjC.Block(&#123;</span><br><span class="line">      types:<span class="string">&#x27;v12@?0B8&#x27;</span>,</span><br><span class="line">      implementation: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          pendingBlocks.delete(newReplyBlock);</span><br><span class="line">      &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = ObjC.classes.JDYLoginCenterProtocolIMP[<span class="string">&#x27;new&#x27;</span>]()</span><br><span class="line">obj[<span class="string">&#x27;- fastSwitchUserWithUserId:resultCallback:&#x27;</span>](userid,newReplyBlock)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h4 id="JS调用OC函数"><a href="#JS调用OC函数" class="headerlink" title="JS调用OC函数"></a>JS调用OC函数</h4><ul>
<li>函数名以”+”开头的类方法，如：“+ URLWithString:”，可以直接通过类名调用方法，相当于java中的static函数</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">urlString = ObjC.classes.NSString.stringWithString_(<span class="string">&quot;MacOS&quot;</span>)</span><br><span class="line">console.log(<span class="string">&quot;urlString=&quot;</span> + urlString.toString());</span><br></pre></td></tr></table></figure>

<ul>
<li>函数名以“-”开头的实例方法，需要找到一个实例化的对象，然后再调用方法</li>
</ul>
<p>1、如果内存中没有这样的对象<br>这种情况需要手动生成一个实例,用法为ObjC.classes.类名.alloc()</p>
<p>2、如果内存中存在实例化后的对象<br>这种情况需要先找出一个类的实例,使用 var tmp = ObjC.chooseSync(ObjC.classes.类名),例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> instance = ObjC.chooseSync(ObjC.classes.PARSHealthHomeViewController)[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<p>其中[0]表示取找到的实例中的第一个实例,可根据实际情况换成其他的实例。<br>调用函数时，以my_obj <code>- requestUploadWithSure</code> 的函数，如果有参数直接附在括号中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (ObjC.available) &#123;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//var my_obj=ObjC.chooseSync(ObjC.classes.PARSHealthHomeViewController)[0]</span></span><br><span class="line">    <span class="keyword">var</span> my_obj=ObjC.classes.PARSHealthHomeViewController.alloc()</span><br><span class="line">    <span class="comment">//调用方法</span></span><br><span class="line">    my_obj[<span class="string">&quot;- requestUploadWithSure:&quot;</span>](<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">catch</span>(<span class="params">err</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;[!] Exception2: &quot;</span> + err.message);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;Objective-C Runtime is not available!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">console.log(<span class="string">&quot;init success&quot;</span>);</span><br><span class="line">function SendTextMessage(wxid, msg) &#123;</span><br><span class="line">  var message = ObjC.chooseSync(ObjC.classes.MessageService)[<span class="number">0</span>]</span><br><span class="line">  var username = ObjC.classes.CUtility.GetCurrentUserName();</span><br><span class="line">  console.log(username)</span><br><span class="line">  console.log(<span class="string">&quot;Type of arg[0] -&gt; &quot;</span> + message)</span><br><span class="line">  var toUsrName = ObjC.classes.NSString.stringWithString_(wxid);</span><br><span class="line">  var msgText = ObjC.classes.NSString.stringWithString_(msg);</span><br><span class="line">  message[<span class="string">&quot;- SendTextMessage:toUsrName:msgText:atUserList:&quot;</span>](username, toUsrName, msgText, null);</span><br><span class="line">&#125;</span><br><span class="line">SendTextMessage(<span class="string">&quot;filehelper&quot;</span>,<span class="string">&quot;主动调用发送信息！&quot;</span>)</span><br></pre></td></tr></table></figure>

<p> 调用 Native 函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> address = Module.findExportByName(<span class="string">&#x27;libsqlite3.dylib&#x27;</span>, <span class="string">&#x27;sqlite3_sql&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> sql = <span class="keyword">new</span> NativeFunction(address, <span class="string">&#x27;char&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>]);</span><br><span class="line">sql(statement);</span><br></pre></td></tr></table></figure>







<h4 id="C-数据类型"><a href="#C-数据类型" class="headerlink" title="C 数据类型"></a>C 数据类型</h4><h5 id="strings"><a href="#strings" class="headerlink" title="strings"></a>strings</h5><ul>
<li>Reading an allocation</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//allocate strings</span></span><br><span class="line"><span class="keyword">const</span> testString = Memory.allocUtf8String(<span class="string">&quot;1234&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//read strings</span></span><br><span class="line">xx.readUtf8String() <span class="comment">//Read UTF8 strings</span></span><br><span class="line">xx.readCString()    <span class="comment">//Read C-Style strings</span></span><br></pre></td></tr></table></figure>

<h5 id="Numbers"><a href="#Numbers" class="headerlink" title="Numbers"></a>Numbers</h5><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> add(<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>simple integers</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Interceptor.attach(addPtr, &#123;</span><br><span class="line"> 	<span class="function"><span class="title">onEnter</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;a: &quot;</span> + args[<span class="number">0</span>].toInt32())</span><br><span class="line">  &#125; </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>API</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>{}.readInt()</td>
<td>Read an Integer from the given address</td>
</tr>
<tr>
<td>{}.readFloat()</td>
<td>Read an Float number from the given address</td>
</tr>
<tr>
<td>{}.readDouble()</td>
<td>Read an double number from the given address</td>
</tr>
<tr>
<td>{}.readLong()</td>
<td>Read an long number from the given address</td>
</tr>
</tbody></table>
<p>{} equals a NativePointer or ptr()</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="function"><span class="title">print_numbers</span>(<span class="params">int *a, int *b</span>)</span> &#123;</span><br><span class="line">  print(<span class="string">&quot;a:%d\nb:%d\n&quot;</span>, *a, *b)</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;a: &quot;</span> + args[<span class="number">0</span>].readInt())</span><br></pre></td></tr></table></figure>

<ul>
<li>writing numbers</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Interceptor.attach(addPtr, &#123;</span><br><span class="line"> 	<span class="function"><span class="title">onEnter</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">    args[<span class="number">0</span>].writeInt(<span class="number">10</span>)</span><br><span class="line">    args[<span class="number">1</span>].writeInt(<span class="number">20</span>)</span><br><span class="line">  &#125; </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h5 id="Pointer"><a href="#Pointer" class="headerlink" title="Pointer"></a>Pointer</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ssize_t recvfrom(int sockfd, <span class="keyword">void</span> *buf, size_t len, int flags, struct sockaddr *src_addr, socklen_t *addrlen)</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">args[<span class="number">5</span>].readPointer()</span><br><span class="line"></span><br><span class="line"><span class="comment">//pointer to offset</span></span><br><span class="line">mybaseAddr = Module.findBaseAddress(<span class="string">&#x27;myLib.so&#x27;</span>)</span><br><span class="line">myoffsetptr = mybaseAddr.add(ptr(<span class="string">&#x27;0x76E&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">//Find process&#x27;s modules</span></span><br><span class="line">Process.enumerateModulesSync()</span><br><span class="line"></span><br><span class="line"><span class="comment">//Getting pointers to exports</span></span><br><span class="line">Module.findExportByName([MODULE_NAME],[EXPORT_NAME])</span><br><span class="line"></span><br><span class="line"><span class="comment">//pinter to ArrayBuffers</span></span><br><span class="line">Memory.allocUtf8String(<span class="string">&#x27;foo&#x27;</span>)</span><br><span class="line"><span class="string">&quot;0x7f81143f6be0&quot;</span></span><br><span class="line">test = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">10</span>)</span><br><span class="line"><span class="number">0</span>000 <span class="number">0</span>0 <span class="number">0</span>0 <span class="number">0</span>0 <span class="number">0</span>0 <span class="number">0</span>0 <span class="number">0</span>0 <span class="number">0</span>0 <span class="number">0</span>0 </span><br><span class="line">test.unwrap()</span><br><span class="line"><span class="string">&quot;0x7fc1743f6930&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="Hexdump"><a href="#Hexdump" class="headerlink" title="Hexdump"></a>Hexdump</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hexdump(address, [, options])</span><br><span class="line">optins:</span><br><span class="line">&#123;</span><br><span class="line">  offset: number,</span><br><span class="line">  length: number,</span><br><span class="line">  header: <span class="literal">true</span>|<span class="literal">false</span>,</span><br><span class="line">  ansi: <span class="literal">true</span>|<span class="literal">false</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Memory-scanning"><a href="#Memory-scanning" class="headerlink" title="Memory scanning"></a>Memory scanning</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-&gt; bin &#x3D; Process.enumerateModulesSync()[0]</span><br><span class="line">&#123;</span><br><span class="line">	&quot;base&quot;: &quot;0x..&quot;,</span><br><span class="line">	&quot;name&quot;: &quot;a.out&quot;,</span><br><span class="line">	&quot;path&quot;: &quot;xx&quot;,</span><br><span class="line">	&quot;size&quot;: 1234</span><br><span class="line">&#125;</span><br><span class="line">-&gt; Memory.scanSync(bin.base, bin.size, &quot;46 52 49 44 41 20 ?? ?? ?? ?? ?? 21&quot;)</span><br><span class="line">[</span><br><span class="line">&#123;</span><br><span class="line">	&quot;address&quot;: &quot;xx&quot;,</span><br><span class="line">	&quot;size&quot;: 12</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">-&gt; console.log(hexdump(ptr(0x1223)))</span><br></pre></td></tr></table></figure>







<h4 id="Objective-C数据类型处理"><a href="#Objective-C数据类型处理" class="headerlink" title="Objective-C数据类型处理"></a>Objective-C数据类型处理</h4><p>Frida 脚本里如何处理 Objective-C 数据类型，比如 NSString、NSData、NSArray、NSDictionary</p>
<h5 id="NSString"><a href="#NSString" class="headerlink" title="NSString"></a>NSString</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ frida-trace -U -m &quot;+[NSURL URLWithString:]&quot; xxx</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">log, args, state</span>) </span>&#123;</span><br><span class="line">  log(<span class="string">&quot;+[NSURL URLWithString:&quot;</span> + args[<span class="number">2</span>] + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> objcUrl = Objc.Object(args[<span class="number">2</span>]); <span class="comment">//获取OC对象NSString</span></span><br><span class="line">  <span class="keyword">var</span> strUrl  = objcUrl.UTF8String();</span><br><span class="line">  log(<span class="string">&quot;httpURL:&quot;</span> + strUrl);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="NSData"><a href="#NSData" class="headerlink" title="NSData"></a>NSData</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ frida-trace -U -m &quot;-[NSURLRequest setHTTPBody:]&quot; -m &quot;NSMutableURLRequest setHTTPBody:&quot; xxx</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> objcData = <span class="keyword">new</span> ObjC.Object(args[<span class="number">2</span>]); <span class="comment">//NSData，不写new也可以</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//NSData转String</span></span><br><span class="line"><span class="keyword">var</span> strBody = Memory.readUtf8String(objcData.bytes(), objcData.length());</span><br><span class="line"></span><br><span class="line"><span class="comment">//NSData转换成string</span></span><br><span class="line"><span class="comment">//先调用NSData的bytes函数得到内存地址，然后调用readUtf8String读取内存中的数据，即可得到字符串</span></span><br><span class="line"><span class="keyword">var</span> strBody = objcData.bytes().readUtf8String(objcData.length());</span><br><span class="line">log(<span class="string">&quot;HTTPBody:&quot;</span> + strBody);</span><br><span class="line"></span><br><span class="line"><span class="comment">//NSData =&gt; Binary Data</span></span><br><span class="line">objcData.bytes().readByteArray(objcData.length())</span><br><span class="line"></span><br><span class="line"><span class="comment">//NSData转二进制数据</span></span><br><span class="line">Memory.readByteArray(objcData.bytes(), objcData.length());</span><br></pre></td></tr></table></figure>

<h5 id="NSDictionary"><a href="#NSDictionary" class="headerlink" title="NSDictionary"></a>NSDictionary</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//遍历NSDictionary</span></span><br><span class="line"><span class="keyword">var</span> dict = <span class="keyword">new</span> ObjC.Object(args[<span class="number">2</span>]);</span><br><span class="line"><span class="keyword">var</span> enumerator = dict.keyEnumerator();</span><br><span class="line"><span class="keyword">var</span> key;</span><br><span class="line"><span class="keyword">while</span> ((key = enumerator.nextObject()) !== <span class="literal">null</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> value = dict.objectForKey_(key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> param_dict = ObjC.classes.NSMutableDictionary.alloc().init();</span><br><span class="line">param_dict.setObject_forKey_(body,<span class="string">&quot;body&quot;</span>);</span><br></pre></td></tr></table></figure>

<h5 id="NSArray"><a href="#NSArray" class="headerlink" title="NSArray"></a>NSArray</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//遍历NSArray</span></span><br><span class="line"><span class="keyword">var</span> array = <span class="keyword">new</span> ObjC.Object(args[<span class="number">2</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Be sure to use valueOf() as NSUInteger is a Number in</span></span><br><span class="line"><span class="comment"> * 32-bit processes, and UInt64 in 64-bit processes. This</span></span><br><span class="line"><span class="comment"> * coerces it into a Number in the latter case.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> count = array.count().valueOf();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i !== count; i++) &#123;</span><br><span class="line">  <span class="keyword">var</span> element = array.objectAtIndex_(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NSArray *arr3 = [NSArray arrayWithObjects:@<span class="string">&quot;one&quot;</span>,@<span class="string">&quot;two&quot;</span>,@<span class="number">1</span>, nil];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> param_Key_Array = ObjC.classes.NSMutableArray.arrayWithObject_(sBody);</span><br><span class="line">param_Key_Array.addObject_(sClient);</span><br><span class="line">param_Key_Array.addObject_(sClientVersion);</span><br><span class="line">param_Key_Array.addObject_(sFunctionId);</span><br><span class="line">param_Key_Array.addObject_(sOpenudid);</span><br></pre></td></tr></table></figure>

<h5 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//读一个结构体</span></span><br><span class="line">Memory.readU32(args[<span class="number">0</span>].add(<span class="number">4</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//Reading a struct</span></span><br><span class="line">args[<span class="number">0</span>].add(<span class="number">4</span>).readU32();</span><br></pre></td></tr></table></figure>

<h5 id="自定义对象"><a href="#自定义对象" class="headerlink" title="自定义对象"></a>自定义对象</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> customObj = <span class="keyword">new</span> ObjC.Object(args[<span class="number">0</span>]);</span><br><span class="line"><span class="keyword">var</span> ivarList = customObj.$ivars;</span><br><span class="line"><span class="keyword">for</span> (key <span class="keyword">in</span> ivarList) &#123;</span><br><span class="line">  log(<span class="string">`key<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;ivarList[key]&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> methodList = customObj.$methods; <span class="comment">//所有方法</span></span><br></pre></td></tr></table></figure>







<h4 id="Python-交互"><a href="#Python-交互" class="headerlink" title="Python 交互"></a>Python 交互</h4><p>Frida 提供了 Python 和 JS 脚本的交互</p>
<h5 id="获取设备"><a href="#获取设备" class="headerlink" title="获取设备"></a>获取设备</h5><p>DeviceManager 类获取设备信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 获取设备管理器</span></span><br><span class="line">    deviceManager = frida.get_device_manager()</span><br><span class="line">    <span class="comment"># 枚举所有连接的设备</span></span><br><span class="line">    print(deviceManager.enumerate_devices())</span><br><span class="line">    <span class="comment"># 根据UDID获取设备</span></span><br><span class="line">    print(deviceManager.get_device(<span class="string">&#x27;00008030-001C19C12281802E&#x27;</span>))</span><br><span class="line">    <span class="comment"># 获取当前连接设备</span></span><br><span class="line">    print(deviceManager.get_usb_device())</span><br><span class="line"></span><br><span class="line"><span class="comment">#输出 </span></span><br><span class="line"><span class="comment">#[Device(id=&quot;local&quot;, name=&quot;Local System&quot;, type=&#x27;local&#x27;), Device(id=&quot;socket&quot;, name=&quot;Local Socket&quot;, type=&#x27;remote&#x27;), Device(id=&quot;00008030-001C19C12281802E&quot;, name=&quot;iPhone&quot;, type=&#x27;usb&#x27;)]</span></span><br><span class="line"><span class="comment">#Device(id=&quot;00008030-001C19C12281802E&quot;, name=&quot;iPhone&quot;, type=&#x27;usb&#x27;)</span></span><br><span class="line"><span class="comment">#Device(id=&quot;00008030-001C19C12281802E&quot;, name=&quot;iPhone&quot;, type=&#x27;usb&#x27;)</span></span><br></pre></td></tr></table></figure>

<h5 id="附加进程"><a href="#附加进程" class="headerlink" title="附加进程"></a>附加进程</h5><p>attach() 附加目标进程，返回一个 Session 实例，参数支持进程名和PID</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"><span class="keyword">from</span> frida.core <span class="keyword">import</span> Device</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    device = frida.get_usb_device() <span class="comment"># type: Device</span></span><br><span class="line">    session = device.attach(<span class="string">u&#x27;微信&#x27;</span>)</span><br><span class="line">    print(session)</span><br><span class="line">    </span><br><span class="line"><span class="comment">#Session(pid=3608)</span></span><br></pre></td></tr></table></figure>

<h5 id="启动进程"><a href="#启动进程" class="headerlink" title="启动进程"></a>启动进程</h5><p>spawn() 启动进程，此时进程处于挂起状态，需要配合 resume() 才能唤醒，这时还可以使用 attach() 附加上去</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"><span class="keyword">from</span> frida.core <span class="keyword">import</span> Device</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    device = frida.get_usb_device() <span class="comment"># type: Device</span></span><br><span class="line">    pid = device.spawn(<span class="string">&#x27;com.tencent.xin&#x27;</span>)</span><br><span class="line">    <span class="comment">#session = device.attach(pid)</span></span><br><span class="line">    device.resume(pid)</span><br></pre></td></tr></table></figure>

<p>device.spawn()  允许带参数执行，下面代码传入 url 参数后会启动 Safari 并打开网站</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pid &#x3D; device.spawn(&#39;com.apple.mobilesafari&#39;, url&#x3D;&quot;https:&#x2F;&#x2F;www.chinapyg.com&quot;)</span><br></pre></td></tr></table></figure>

<h5 id="脱离进程"><a href="#脱离进程" class="headerlink" title="脱离进程"></a>脱离进程</h5><p>得到 Session 并操作完毕后，需要使用 detach() 脱离进程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.detach()</span><br></pre></td></tr></table></figure>

<h5 id="注入JS脚本"><a href="#注入JS脚本" class="headerlink" title="注入JS脚本"></a>注入JS脚本</h5><p>得到Session就可以使用 create_script() 创建一个脚本对象，然后调用 load() 方法将脚本载入。此时 python 的任务完成，主要工作就交给 JS 了</p>
<ul>
<li>枚举指定进程的所有模块信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"><span class="keyword">from</span> frida.core <span class="keyword">import</span> Device</span><br><span class="line"><span class="keyword">from</span> frida.core <span class="keyword">import</span> Session</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enumerateModules</span>(<span class="params">target_process</span>):</span></span><br><span class="line">    session = frida.get_usb_device().attach(target_process) <span class="comment"># type: Session</span></span><br><span class="line">    script = session.create_script(</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Process.(&#123;</span></span><br><span class="line"><span class="string">        onMatch: function(module) &#123;</span></span><br><span class="line"><span class="string">            console.log(&#x27;Module name:&#x27; + module.name + &#x27;-&#x27; + &#x27;Base Address:&#x27; + module.base);</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        onComplete: function() &#123;&#125;</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    )</span><br><span class="line">    script.load()</span><br><span class="line">    session.detach()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    enumerateModules(<span class="string">&#x27;微信&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>可以将JS脚本嵌套在Python源文件中，也可以将JS保存到专门文件中再读取</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> codecs  </span><br><span class="line">...</span><br><span class="line"><span class="keyword">with</span> codecs.<span class="built_in">open</span>(<span class="string">&#x27;./WeChat.js&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">   source = f.read()</span><br><span class="line">script = session.create_script(source)</span><br></pre></td></tr></table></figure>

<ul>
<li>获取应用沙盒路径</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取沙盒路径</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getHomeDirectory</span>(<span class="params">target_process</span>):</span></span><br><span class="line">	session = frida.get_usb_device().attach(target_process)</span><br><span class="line">  script = session.create_script(</span><br><span class="line">  <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">  if (ObjC.available) &#123;</span></span><br><span class="line"><span class="string">  	var NSHomeDirectory = new NativeFunction(ptr(Module.findExportByName(&quot;Foundation&quot;, &quot;NSHomeDirectory&quot;), &#x27;pointer&#x27;, []));</span></span><br><span class="line"><span class="string">  	var path = new ObjC.Object(NSHomeDirectory());</span></span><br><span class="line"><span class="string">  	console.log(path);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  &quot;&quot;&quot;</span></span><br><span class="line">  )</span><br><span class="line">  script.load()</span><br><span class="line">  session.detach()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  getHomeDirectory(<span class="string">u&quot;微信&quot;</span>)</span><br></pre></td></tr></table></figure>



<h5 id="Python与JS交互传值"><a href="#Python与JS交互传值" class="headerlink" title="Python与JS交互传值"></a>Python与JS交互传值</h5><ul>
<li>获取指定进程的指定模块信息</li>
</ul>
<p>上面JS脚本都是不需要传递参数，需要参数时，Python与JS如何交互</p>
<p>Script 类可以设置回调函数，用来处理JS端传来的消息；JS端设置 recv() 的回调来接收Python端的消息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">g_event = threading.Event()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">payload_message</span>(<span class="params">payload</span>):</span></span><br><span class="line">  <span class="keyword">if</span> payload.has_key(<span class="string">&#x27;msg&#x27;</span>):</span><br><span class="line">    print(payload[<span class="string">&#x27;msg&#x27;</span>])</span><br><span class="line">  <span class="keyword">if</span> payload.has_key(<span class="string">&#x27;status&#x27;</span>):</span><br><span class="line">    <span class="keyword">if</span> payload[<span class="string">&#x27;status&#x27;</span>] == <span class="string">&#x27;success&#x27;</span>:</span><br><span class="line">      g_event.<span class="built_in">set</span>()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_message</span>(<span class="params">message, data</span>):</span></span><br><span class="line">  <span class="keyword">if</span> message[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;send&#x27;</span>:</span><br><span class="line">    payload_message(message[<span class="string">&#x27;payload&#x27;</span>])</span><br><span class="line">  <span class="keyword">elif</span> message[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;error&#x27;</span>:</span><br><span class="line">    print(message[<span class="string">&#x27;stack&#x27;</span>])</span><br><span class="line"></span><br><span class="line">PP_JS = (</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">function getModuleByName(name) &#123;</span></span><br><span class="line"><span class="string">	return Process.getModuleByName(name);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function findBaseAddress(name) &#123;</span></span><br><span class="line"><span class="string">	return Module.findBaseAddress(name);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function handleMessage(message) &#123;</span></span><br><span class="line"><span class="string">	if(message[&#x27;cmd&#x27;]) &#123;</span></span><br><span class="line"><span class="string">		if(message[&#x27;cmd&#x27;] == &#x27;GetModuleByName&#x27;) &#123;</span></span><br><span class="line"><span class="string">			var module = getModuleByName(message[&#x27;name&#x27;]);</span></span><br><span class="line"><span class="string">			if (module) send(&#123;msg: module&#125;);</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">		if(message[&#x27;cmd&#x27;] == &#x27;FindBaseAddress&#x27;) &#123;</span></span><br><span class="line"><span class="string">			var address = findBaseAddress(emssage[&#x27;name&#x27;]);</span></span><br><span class="line"><span class="string">			if (address) send(&#123;msg: address&#125;);</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">	send(&#123;status: &#x27;success&#x27;&#125;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">recv(handleMessage)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">#根据名字获取模块信息</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getModuleByNmae</span>(<span class="params">target_process, name</span>):</span></span><br><span class="line">  session = frida.get_usb_device().attach(target_process)</span><br><span class="line">  script = session.create_script(PP_JS)</span><br><span class="line">  script.on(<span class="string">&#x27;message&#x27;</span>, on_message)</span><br><span class="line">  script.load()</span><br><span class="line">  script.post(&#123;<span class="string">&#x27;cmd&#x27;</span>: <span class="string">&#x27;GetModuleByName&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: name&#125;)</span><br><span class="line">  g_event.wait()</span><br><span class="line">  session.detach()</span><br><span class="line"><span class="comment">#根据名字获取模块地址</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findBaseAddress</span>(<span class="params">target_process, name</span>):</span></span><br><span class="line">  session = frida.get_usb_device().attach(target_process)</span><br><span class="line">  script = session.create_script(PP_JS)</span><br><span class="line">  script.on(<span class="string">&#x27;message&#x27;</span>, on_message)</span><br><span class="line">  script.load()</span><br><span class="line">  script.post(&#123;<span class="string">&#x27;cmd&#x27;</span>: <span class="string">&#x27;FindBaseAddress&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: name&#125;)</span><br><span class="line">  g_event.wait()</span><br><span class="line">  session.detach()</span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  getModuleByName(<span class="string">u&quot;微信&quot;</span>, <span class="string">&quot;mars&quot;</span>)</span><br><span class="line">  findBaseAddress(<span class="string">u&quot;微信&quot;</span>, <span class="string">&quot;mars&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>g_event是保证同步的，Python端使用script.post()将参数发送出去之后就调用g_event.wait()进入等待状态，当JS处理完成后，会将status设为“success”，再使用send()发送给Python端设置的on_message()回调，最终在payload_message()函数中完成逻辑处理，当识别到status为“success”后，调用g_event.set()使主线程继续执行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通用hook</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hookClassMethod</span>(<span class="params">classname, methodname, infotip</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">var</span> hooking = ObjC.classes[classname][methodname]</span><br><span class="line">			Interceptor.attach(hooking.implementation,&#123;</span><br><span class="line">			onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">				<span class="comment">//args[0]:self</span></span><br><span class="line">				<span class="comment">//args[1]:The selector</span></span><br><span class="line">				<span class="comment">//args[2]:方法的第一个参数开始</span></span><br><span class="line">				<span class="built_in">console</span>.log(<span class="string">&#x27;\n&#x27;</span> + infotip + <span class="string">&#x27; Hook Success&#x27;</span>)</span><br><span class="line">				<span class="built_in">this</span>.class_name  = ObjC.Object(args[<span class="number">0</span>]).toString()</span><br><span class="line">				<span class="built_in">this</span>.method_name = ObjC.selectorAsString(args[<span class="number">1</span>])</span><br><span class="line">				<span class="built_in">console</span>.log(<span class="string">&#x27;\t[-] &#x27;</span> + <span class="string">&#x27;onEnter args[0] class_name: &#x27;</span> + <span class="built_in">this</span>.class_name)</span><br><span class="line">				<span class="built_in">console</span>.log(<span class="string">&#x27;\t[-] &#x27;</span> + <span class="string">&#x27;onEnter args[1] method_name: &#x27;</span> + <span class="built_in">this</span>.method_name)</span><br><span class="line">			&#125;,</span><br><span class="line">			onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>)</span>&#123;</span><br><span class="line">				<span class="built_in">console</span>.log(<span class="string">&#x27;\t[-]Return value: &#x27;</span>)</span><br><span class="line">				<span class="comment">//返回值类型</span></span><br><span class="line">				<span class="keyword">var</span> typeValue = <span class="built_in">Object</span>.prototype.toString.call(retval)</span><br><span class="line">				<span class="built_in">console</span>.log(<span class="string">&#x27;\t[-] Type of return value: &#x27;</span> + typeValue)</span><br><span class="line">				<span class="built_in">console</span>.log(<span class="string">&#x27;\t[-] Return value: &#x27;</span>, retval)</span><br><span class="line">				<span class="built_in">console</span>.log(<span class="string">&#x27;\t[-] &#x27;</span> + <span class="string">&#x27;返回值: &#x27;</span> + ObjC.Object(retval).toString())</span><br><span class="line"></span><br><span class="line">        send(&#123;<span class="attr">msg</span>: ObjC.Object(retval).toString()&#125;)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;<span class="function"><span class="title">catch</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">&quot;\t[!] &quot;</span> + infotip + <span class="string">&quot; Exception: &quot;</span> + err.message);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handle_py_message</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;接收到python发送的消息&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (message[<span class="string">&#x27;cmd&#x27;</span>] == <span class="string">&#x27;cmd111&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">//根据cmd调用js方法</span></span><br><span class="line">        <span class="built_in">console</span>.log(message[<span class="string">&#x27;cmd&#x27;</span>])</span><br><span class="line">    &#125;</span><br><span class="line">    send(&#123;<span class="attr">status</span>: <span class="string">&#x27;success&#x27;</span>&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (ObjC.available) &#123; <span class="comment">//OC类加载完成</span></span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;\n[*] Starting Hooking&#x27;</span>)</span><br><span class="line">	hookClassMethod(<span class="string">&#x27;SGSCorpusPageView&#x27;</span>, <span class="string">&#x27;- pageDataList&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>)</span><br><span class="line">	recv(handle_py_message)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">bundle = <span class="string">&#x27;com.sogou.sogouinput&#x27;</span></span><br><span class="line"></span><br><span class="line">g_event = threading.Event()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">payload_message</span>(<span class="params">payload</span>):</span></span><br><span class="line">	<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">	处理消息逻辑</span></span><br><span class="line"><span class="string">	:param payload:</span></span><br><span class="line"><span class="string">	:return:</span></span><br><span class="line"><span class="string">	&#x27;&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">if</span> <span class="string">&#x27;msg&#x27;</span> <span class="keyword">in</span> payload:</span><br><span class="line">		print(payload[<span class="string">&#x27;msg&#x27;</span>])</span><br><span class="line">	<span class="keyword">if</span> <span class="string">&#x27;status&#x27;</span> <span class="keyword">in</span> payload:</span><br><span class="line">		<span class="keyword">if</span> payload[<span class="string">&#x27;status&#x27;</span>] == <span class="string">&#x27;success&#x27;</span>:</span><br><span class="line">			<span class="comment">#调用g_event.set()使主线程继续执行</span></span><br><span class="line">			g_event.<span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_js_message</span>(<span class="params">message, data</span>):</span></span><br><span class="line">	<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">	接收到JS消息</span></span><br><span class="line"><span class="string">	&#123;&#x27;type&#x27;: &#x27;send&#x27;, &#x27;payload&#x27;: &#123;&#x27;status&#x27;: &#x27;success&#x27;&#125;&#125;</span></span><br><span class="line"><span class="string">	:param message:</span></span><br><span class="line"><span class="string">	:return:</span></span><br><span class="line"><span class="string">	&#x27;&#x27;&#x27;</span></span><br><span class="line">	<span class="comment"># print(message)</span></span><br><span class="line">	<span class="comment"># print(data)</span></span><br><span class="line">	<span class="keyword">if</span> message[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;send&#x27;</span>:</span><br><span class="line">		payload_message(message[<span class="string">&#x27;payload&#x27;</span>])</span><br><span class="line">	<span class="keyword">elif</span> message[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;error&#x27;</span>:</span><br><span class="line">		print(message[<span class="string">&#x27;stack&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> codecs.<span class="built_in">open</span>(<span class="string">&#x27;sougou.js&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    source = f.read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	device = frida.get_usb_device(<span class="number">1000</span>) <span class="comment">#连接usb设备 1000表示超时</span></span><br><span class="line">	pid = device.spawn(bundle) <span class="comment">#启动指定bundleId的app</span></span><br><span class="line">	session = device.attach(pid)  <span class="comment">#附加到app</span></span><br><span class="line">	<span class="comment"># 创建frida javaScript脚本</span></span><br><span class="line">	script = session.create_script(source) <span class="comment"># type: frida.core.Script</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">#参数：信号single 回调callback， single固定message</span></span><br><span class="line">	script.on(<span class="string">&#x27;message&#x27;</span>, handle_js_message)</span><br><span class="line">	script.load() <span class="comment">#load脚本到app进程中 这样即注入成功</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">#发送消息</span></span><br><span class="line">	script.post(&#123;<span class="string">&#x27;cmd&#x27;</span>: <span class="string">&#x27;cmd111&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;nameValue&#x27;</span>&#125;)</span><br><span class="line">	<span class="comment">#消息发送给JS后，调用g_event.wait进入等待 当JS处理完成后，会将status设为“success”</span></span><br><span class="line">	g_event.wait()</span><br><span class="line"></span><br><span class="line">	device.resume(pid) <span class="comment">#恢复app运行</span></span><br><span class="line">	sys.stdin.read()<span class="comment">#读取打印日志</span></span><br></pre></td></tr></table></figure>





<h5 id="JS脚本-1"><a href="#JS脚本-1" class="headerlink" title="JS脚本"></a>JS脚本</h5><p>hook.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (ObjC.available) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;hello world&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>hook.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"></span><br><span class="line">bundle = <span class="string">&#x27;com.CMake&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    device = frida.get_usb_device()</span><br><span class="line">    pid = device.spawn(bundle) <span class="comment">#启动指定bundleid进程</span></span><br><span class="line">    session = device.attach(pid) <span class="comment">#附加app</span></span><br><span class="line">    <span class="keyword">with</span> codecs.<span class="built_in">open</span>(<span class="string">&#x27;./hook.js&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        source = f.read() <span class="comment">#读取脚本文件</span></span><br><span class="line">    script = session.create_script(source) <span class="comment">#创建 frida JavaScript脚本</span></span><br><span class="line">    script.load() <span class="comment">#加载脚本</span></span><br><span class="line">    device.resume(pid) <span class="comment">#唤醒回复app运行</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#云行后打印 hello world</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>可以用来代替 vmmap 来获取加载基地址</p>
</blockquote>
<h4 id="Swift-Hook"><a href="#Swift-Hook" class="headerlink" title="Swift Hook"></a>Swift Hook</h4><p>终端</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Module.enumerateImportsSync(<span class="string">&quot;SwiftCLT&quot;</span>) #SwiftCLT 包名</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;address&quot;</span>: <span class="string">&quot;0xxxxx&quot;</span>,</span><br><span class="line">  <span class="string">&quot;module&quot;</span>: <span class="string">&quot;/System/Library/Frameworks/CryptoKit.framework...&quot;</span>,</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;$s9CryptoKit3A...&quot;</span>,</span><br><span class="line">  <span class="string">&quot;slot&quot;</span>: <span class="string">&quot;0xxxxx&quot;</span>,</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查找到类型名子后可以再 attach</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> imports = Module.enumerateImportsSync(<span class="string">&quot;SwiftCLT&quot;</span>)</span><br><span class="line">imports.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">  <span class="function"><span class="title">if</span>(<span class="params">value.name==<span class="string">&quot;xxx&quot;</span></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;[+] Address: &quot;</span> + value.address)</span><br><span class="line">    Interceptor.attach(value.address, &#123;</span><br><span class="line">      <span class="function"><span class="title">onEnter</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;raw data: &quot;</span>+args[<span class="number">0</span>].readCString())</span><br><span class="line">        <span class="built_in">console</span>.log(hexdump(args[<span class="number">0</span>]))</span><br><span class="line">        <span class="keyword">let</span> rawData = args[<span class="number">0</span>].readCString()</span><br><span class="line">        <span class="keyword">let</span> key = args[<span class="number">0</span>].add(rawData.length+<span class="number">0x3</span>).readCString()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>







<h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><h5 id="加密参数打印"><a href="#加密参数打印" class="headerlink" title="加密参数打印"></a>加密参数打印</h5><h6 id="CCCrypt"><a href="#CCCrypt" class="headerlink" title="CCCrypt"></a>CCCrypt</h6><p>下载工程 <a target="_blank" rel="noopener" href="https://github.com/GuanlinORZ/friDemo">https://github.com/GuanlinORZ/friDemo</a> 或加代理下载 <a target="_blank" rel="noopener" href="https://gh.fakev.cn/GuanlinORZ/friDemo">https://gh.fakev.cn/GuanlinORZ/friDemo</a></p>
<p>跟踪函数</p>
<p>分析 CCCrypt 函数的加密</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CCCryptorStatus CCCrypt( </span><br><span class="line">  CCOperation op,      <span class="comment">//kCCEncrypt为加密，kCCDecrypt为解密 </span></span><br><span class="line">  CCAlgorithm alg,     <span class="comment">//加密方式 kCCAlgorithmAES128为AES加密</span></span><br><span class="line">  CCOptions options,   <span class="comment">//增充方式</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">void</span> *key,     <span class="comment">//密钥</span></span><br><span class="line">  size_t keyLength,    <span class="comment">//密钥长度</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">void</span> *iv,      <span class="comment">// IV</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">void</span> *dataIn,  <span class="comment">//待加密的原文</span></span><br><span class="line">  size_t dataInLength, <span class="comment">//原文长度</span></span><br><span class="line">  <span class="keyword">void</span> *dataOut,       <span class="comment">//加密后输出的数据</span></span><br><span class="line">  size_t dataOutAvailable,  </span><br><span class="line">  size_t *dataOutMoved)</span><br></pre></td></tr></table></figure>

<p>运行项目，跟踪函数调用</p>
<p>点击项目按钮，调用加密方法，可以看到跟踪函数调用的参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#-i 跟踪函数</span><br><span class="line">$ frida-trace -U -i CCCrypt DesDemo </span><br><span class="line"></span><br><span class="line">Instrumenting...</span><br><span class="line">CCCrypt: Auto-generated handler at &quot;&#x2F;Users&#x2F;xxx&#x2F;Desktop&#x2F;WeChat&#x2F;__handlers__&#x2F;libcommonCrypto.dylib&#x2F;CCCrypt.js&quot;</span><br><span class="line">Started tracing 1 function. Press Ctrl+C to stop.</span><br><span class="line">           &#x2F;* TID 0x103 *&#x2F;</span><br><span class="line">  9217 ms  CCCrypt(op&#x3D;0x0, alg&#x3D;0x1, options&#x3D;0x1, key&#x3D;0x102363d50, keyLength&#x3D;0x8, iv&#x3D;0x16daa4e20, dataIn&#x3D;0x280a01531, dataInLength&#x3D;0xa, dataOut&#x3D;0x16daa4e28, dataOutAvailable&#x3D;0x400, dataOutMoved&#x3D;0x16daa4de0)</span><br></pre></td></tr></table></figure>

<p>并且生成了 handlers/CCCrypt.js 文件</p>
<p>有两个函数，onEnter 是进入函数时会执行的代码，onLeave是函数执行完离开时会执行的代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="title">onEnter</span>(<span class="params">log, args, state</span>)</span> &#123;</span><br><span class="line">    log(<span class="string">`CCCrypt(op=<span class="subst">$&#123;args[<span class="number">0</span>]&#125;</span>, alg=<span class="subst">$&#123;args[<span class="number">1</span>]&#125;</span>, options=<span class="subst">$&#123;args[<span class="number">2</span>]&#125;</span>, key=<span class="subst">$&#123;args[<span class="number">3</span>]&#125;</span>, keyLength=<span class="subst">$&#123;args[<span class="number">4</span>]&#125;</span>, iv=<span class="subst">$&#123;args[<span class="number">5</span>]&#125;</span>, dataIn=<span class="subst">$&#123;args[<span class="number">6</span>]&#125;</span>, dataInLength=<span class="subst">$&#123;args[<span class="number">7</span>]&#125;</span>, dataOut=<span class="subst">$&#123;args[<span class="number">8</span>]&#125;</span>, dataOutAvailable=<span class="subst">$&#123;args[<span class="number">9</span>]&#125;</span>, dataOutMoved=<span class="subst">$&#123;args[<span class="number">10</span>]&#125;</span>)`</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">onLeave</span>(<span class="params">log, retval, state</span>)</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改内容 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  onEnter: <span class="function"><span class="keyword">function</span> (<span class="params">log, args, state</span>) </span>&#123;</span><br><span class="line">    log(<span class="string">&#x27;CCCrypt(&#x27;</span> +</span><br><span class="line">      <span class="string">&#x27;op=&#x27;</span> + args[<span class="number">0</span>] +</span><br><span class="line">      <span class="string">&#x27;, alg=&#x27;</span> + args[<span class="number">1</span>] +</span><br><span class="line">      <span class="string">&#x27;, options=&#x27;</span> + args[<span class="number">2</span>] +</span><br><span class="line">      <span class="string">&#x27;, key=&#x27;</span> + args[<span class="number">3</span>] +</span><br><span class="line">      <span class="string">&#x27;, keyLength=&#x27;</span> + args[<span class="number">4</span>] +</span><br><span class="line">      <span class="string">&#x27;, iv=&#x27;</span> + args[<span class="number">5</span>] +</span><br><span class="line">      <span class="string">&#x27;, dataIn=&#x27;</span> + args[<span class="number">6</span>] +</span><br><span class="line">      <span class="string">&#x27;, dataInLength=&#x27;</span> + args[<span class="number">7</span>] +</span><br><span class="line">      <span class="string">&#x27;, dataOut=&#x27;</span> + args[<span class="number">8</span>] +</span><br><span class="line">      <span class="string">&#x27;, dataOutAvailable=&#x27;</span> + args[<span class="number">9</span>] +</span><br><span class="line">      <span class="string">&#x27;, dataOutMoved=&#x27;</span> + args[<span class="number">10</span>] +</span><br><span class="line">    <span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">    <span class="comment">//保存参数</span></span><br><span class="line">    <span class="built_in">this</span>.operation   = args[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">this</span>.CCAlgorithm = args[<span class="number">1</span>]</span><br><span class="line">    <span class="built_in">this</span>.CCOptions   = args[<span class="number">2</span>]</span><br><span class="line">    <span class="built_in">this</span>.keyBytes    = args[<span class="number">3</span>]</span><br><span class="line">    <span class="built_in">this</span>.keyLength   = args[<span class="number">4</span>]</span><br><span class="line">    <span class="built_in">this</span>.ivBuffer    = args[<span class="number">5</span>]</span><br><span class="line">    <span class="built_in">this</span>.inBuffer    = args[<span class="number">6</span>]</span><br><span class="line">    <span class="built_in">this</span>.inLength    = args[<span class="number">7</span>]</span><br><span class="line">    <span class="built_in">this</span>.outBuffer   = args[<span class="number">8</span>]</span><br><span class="line">    <span class="built_in">this</span>.outLength   = args[<span class="number">9</span>]</span><br><span class="line">    <span class="built_in">this</span>.outCountPtr = args[<span class="number">10</span>]</span><br><span class="line">    <span class="comment">//this.operation == 0 代表是加密</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.operation == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//打印加密前的原文</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;In buffer:&quot;</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(hexdump(ptr(<span class="built_in">this</span>.inBuffer), &#123;</span><br><span class="line">            length: <span class="built_in">this</span>.inLength.toInt32(),</span><br><span class="line">            header: <span class="literal">true</span>,</span><br><span class="line">            ansi: <span class="literal">true</span></span><br><span class="line">        &#125;))</span><br><span class="line">        <span class="comment">//打印密钥</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Key: &quot;</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(hexdump(ptr(<span class="built_in">this</span>.keyBytes), &#123;</span><br><span class="line">            length: <span class="built_in">this</span>.keyLength.toInt32(),</span><br><span class="line">            header: <span class="literal">true</span>,</span><br><span class="line">            ansi: <span class="literal">true</span></span><br><span class="line">        &#125;))</span><br><span class="line">        <span class="comment">//打印 IV</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;IV: &quot;</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(hexdump(ptr(<span class="built_in">this</span>.ivBuffer), &#123;</span><br><span class="line">            length: <span class="built_in">this</span>.keyLength.toInt32(),</span><br><span class="line">            header: <span class="literal">true</span>,</span><br><span class="line">            ansi: <span class="literal">true</span></span><br><span class="line">        &#125;))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  onLeave: <span class="function"><span class="keyword">function</span> (<span class="params">log, retval, state</span>) </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ptr(s) 定义一个指针 指针地址为s </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">operation: 0x0代表加密，0x1代表解密</span></span><br><span class="line"><span class="comment">enum &#123;</span></span><br><span class="line"><span class="comment">	kCCEncrypt = 0,	</span></span><br><span class="line"><span class="comment">	kCCDecrypt = 1	</span></span><br><span class="line"><span class="comment">&#125;;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">CCAlgorithm: 0x0指加密方式是AES加密，0x1指DES加密，0x2指3DES加密</span></span><br><span class="line"><span class="comment">enum &#123;</span></span><br><span class="line"><span class="comment">	kCCAlgorithmAES128 = 0,</span></span><br><span class="line"><span class="comment">	kCCAlgorithmAES    = 0,</span></span><br><span class="line"><span class="comment">	kCCAlgorithmDES    = 1,</span></span><br><span class="line"><span class="comment">	kCCAlgorithm3DES   = 2,		</span></span><br><span class="line"><span class="comment">	kCCAlgorithmCAST   = 3,		</span></span><br><span class="line"><span class="comment">	kCCAlgorithmRC4    = 4,</span></span><br><span class="line"><span class="comment">	kCCAlgorithmRC2	   = 5	</span></span><br><span class="line"><span class="comment">&#125;;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">CCOptions: 0x1指模式是CBC，通常0x3指ECB</span></span><br><span class="line"><span class="comment">enum &#123;</span></span><br><span class="line"><span class="comment">	kCCOptionPKCS7Padding	= 0x0001,</span></span><br><span class="line"><span class="comment">	kCCOptionECBMode	= 0x0002</span></span><br><span class="line"><span class="comment">&#125;;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//或者使用 Interceptor.attach</span></span><br><span class="line">Interceptor.attach(Module.findExportByName(<span class="string">&#x27;libcommonCrypto.dylib&#x27;</span>, <span class="string">&#x27;CCCrypt&#x27;</span>), &#123;</span><br><span class="line">    onEnter: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// Save the arguments</span></span><br><span class="line">        <span class="built_in">this</span>.operation   = args[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">this</span>.CCAlgorithm = args[<span class="number">1</span>]</span><br><span class="line">        <span class="built_in">this</span>.CCOptions   = args[<span class="number">2</span>]</span><br><span class="line">        <span class="built_in">this</span>.keyBytes    = args[<span class="number">3</span>]</span><br><span class="line">        <span class="built_in">this</span>.keyLength   = args[<span class="number">4</span>]</span><br><span class="line">        <span class="built_in">this</span>.ivBuffer    = args[<span class="number">5</span>]</span><br><span class="line">        <span class="built_in">this</span>.inBuffer    = args[<span class="number">6</span>]</span><br><span class="line">        <span class="built_in">this</span>.inLength    = args[<span class="number">7</span>]</span><br><span class="line">        <span class="built_in">this</span>.outBuffer   = args[<span class="number">8</span>]</span><br><span class="line">        <span class="built_in">this</span>.outLength   = args[<span class="number">9</span>]</span><br><span class="line">        <span class="built_in">this</span>.outCountPtr = args[<span class="number">10</span>]</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;CCCrypt(&#x27;</span> + </span><br><span class="line">            <span class="string">&#x27;operation: &#x27;</span>   + <span class="built_in">this</span>.operation    +<span class="string">&#x27;, &#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;CCAlgorithm: &#x27;</span> + <span class="built_in">this</span>.CCAlgorithm  +<span class="string">&#x27;, &#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;CCOptions: &#x27;</span>   + <span class="built_in">this</span>.CCOptions    +<span class="string">&#x27;, &#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;keyBytes: &#x27;</span>    + <span class="built_in">this</span>.keyBytes     +<span class="string">&#x27;, &#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;keyLength: &#x27;</span>   + <span class="built_in">this</span>.keyLength    +<span class="string">&#x27;, &#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;ivBuffer: &#x27;</span>    + <span class="built_in">this</span>.ivBuffer     +<span class="string">&#x27;, &#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;inBuffer: &#x27;</span>    + <span class="built_in">this</span>.inBuffer     +<span class="string">&#x27;, &#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;inLength: &#x27;</span>    + <span class="built_in">this</span>.inLength     +<span class="string">&#x27;, &#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;outBuffer: &#x27;</span>   + <span class="built_in">this</span>.outBuffer    +<span class="string">&#x27;, &#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;outLength: &#x27;</span>   + <span class="built_in">this</span>.outLength    +<span class="string">&#x27;, &#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;outCountPtr: &#x27;</span> + <span class="built_in">this</span>.outCountPtr  +<span class="string">&#x27;)&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.operation == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// Show the buffers here if this an encryption operation</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;In buffer:&quot;</span>)</span><br><span class="line">            <span class="built_in">console</span>.log(hexdump(ptr(<span class="built_in">this</span>.inBuffer), &#123;</span><br><span class="line">                length: <span class="built_in">this</span>.inLength.toInt32(),</span><br><span class="line">                header: <span class="literal">true</span>,</span><br><span class="line">                ansi: <span class="literal">true</span></span><br><span class="line">            &#125;))</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;Key: &quot;</span>)</span><br><span class="line">            <span class="built_in">console</span>.log(hexdump(ptr(<span class="built_in">this</span>.keyBytes), &#123;</span><br><span class="line">                length: <span class="built_in">this</span>.keyLength.toInt32(),</span><br><span class="line">                header: <span class="literal">true</span>,</span><br><span class="line">                ansi: <span class="literal">true</span></span><br><span class="line">            &#125;))</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;IV: &quot;</span>)</span><br><span class="line">            <span class="built_in">console</span>.log(hexdump(ptr(<span class="built_in">this</span>.ivBuffer), &#123;</span><br><span class="line">                length: <span class="built_in">this</span>.keyLength.toInt32(),</span><br><span class="line">                header: <span class="literal">true</span>,</span><br><span class="line">                ansi: <span class="literal">true</span></span><br><span class="line">            &#125;))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    onLeave: <span class="function"><span class="keyword">function</span> (<span class="params">retVal</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.operation == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// Show the buffers here if this a decryption operation</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;Out buffer:&quot;</span>)</span><br><span class="line">            <span class="built_in">console</span>.log(hexdump(ptr(<span class="built_in">this</span>.outBuffer), &#123;</span><br><span class="line">                length: Memory.readUInt(<span class="built_in">this</span>.outCountPtr),</span><br><span class="line">                header: <span class="literal">true</span>,</span><br><span class="line">                ansi: <span class="literal">true</span></span><br><span class="line">            &#125;))</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;Key: &quot;</span>)</span><br><span class="line">            <span class="built_in">console</span>.log(hexdump(ptr(<span class="built_in">this</span>.keyBytes), &#123;</span><br><span class="line">                length: <span class="built_in">this</span>.keyLength.toInt32(),</span><br><span class="line">                header: <span class="literal">true</span>,</span><br><span class="line">                ansi: <span class="literal">true</span></span><br><span class="line">            &#125;))</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;IV: &quot;</span>)</span><br><span class="line">            <span class="built_in">console</span>.log(hexdump(ptr(<span class="built_in">this</span>.ivBuffer), &#123;</span><br><span class="line">                length: <span class="built_in">this</span>.keyLength.toInt32(),</span><br><span class="line">                header: <span class="literal">true</span>,</span><br><span class="line">                ansi: <span class="literal">true</span></span><br><span class="line">            &#125;))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//hexdump 打印内存中的地址</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">var libc = Module.findBaseAddress(&#x27;libc.so&#x27;);</span></span><br><span class="line"><span class="comment">console.log(hexdump(libc, &#123;</span></span><br><span class="line"><span class="comment">  offset: 0,</span></span><br><span class="line"><span class="comment">  length: 64,</span></span><br><span class="line"><span class="comment">  header: true,</span></span><br><span class="line"><span class="comment">  ansi: true</span></span><br><span class="line"><span class="comment">&#125;));</span></span><br><span class="line"><span class="comment">           0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span></span><br><span class="line"><span class="comment">00000000  7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00  .ELF............</span></span><br><span class="line"><span class="comment">00000010  03 00 28 00 01 00 00 00 00 00 00 00 34 00 00 00  ..(.........4...</span></span><br><span class="line"><span class="comment">00000020  34 a8 04 00 00 00 00 05 34 00 20 00 08 00 28 00  4.......4. ...(.</span></span><br><span class="line"><span class="comment">00000030  1e 00 1d 00 06 00 00 00 34 00 00 00 34 00 00 00  ........4...4...</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>再次执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ frida-trace -U -i CCCrypt DesDemo</span><br><span class="line"></span><br><span class="line">Started tracing 1 function. Press Ctrl+C to stop.</span><br><span class="line">In buffer:</span><br><span class="line">            0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">280a14451  72 32 34 33 34 33 34 33 34 33                    r243434343</span><br><span class="line">Key:</span><br><span class="line">            0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">102363d50  78 78 78 78 00 21 2a 27                          xxxx.!*&#39;</span><br><span class="line">IV:</span><br><span class="line">            0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">16daa4e20  12 34 56 78 90 ab cd ef                          .4Vx....</span><br><span class="line">           &#x2F;* TID 0x103 *&#x2F;</span><br><span class="line">  1813 ms  CCCrypt(op&#x3D;0x0, alg&#x3D;0x1, options&#x3D;0x1, key&#x3D;0x102363d50, keyLength&#x3D;0x8, iv&#x3D;0x16daa4e20, dataIn&#x3D;0x280a14451, dataInLength&#x3D;0xa, dataOut&#x3D;0x16daa4e28, dataOutAvailable&#x3D;0x400, dataOutMoved&#x3D;0x16daa4de0)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;可以看到加密前字符串 r243434343</span><br></pre></td></tr></table></figure>

<h6 id="CC-MD5"><a href="#CC-MD5" class="headerlink" title="CC_MD5"></a>CC_MD5</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">CC_MD5(fooData, (CC_LONG)strlen(fooData), result);</span><br><span class="line"></span><br><span class="line"><span class="comment">//参数1:要加密的字符串</span></span><br><span class="line"><span class="comment">//参数2: 获取要加密字符串的长度</span></span><br><span class="line"><span class="comment">//参数3: 接收结果的数组</span></span><br><span class="line"><span class="comment">//返回一个32位长度的加密后的字符串</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//js</span></span><br><span class="line">&#123;</span><br><span class="line">  onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">log, args, state</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//将md5参数转成字符串并打印</span></span><br><span class="line">    <span class="keyword">var</span> md5_data = args[<span class="number">0</span>].readUtf8String();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;MD5-参数值:&#x27;</span>);</span><br><span class="line">    <span class="built_in">console</span>.error(md5_data);</span><br><span class="line">  &#125;, </span><br><span class="line">  onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">log, retval, state</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//将md5返回值转码为32位字符串并打印</span></span><br><span class="line">    <span class="keyword">var</span> md5_digest = hexdump(retval, &#123;<span class="attr">length</span>: <span class="number">16</span>&#125;);</span><br><span class="line">    <span class="keyword">var</span> hexified = <span class="string">&quot; &quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> raw_array = md5_digest.split(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> a=<span class="number">0</span>;a&lt; raw_array.length,a++)&#123;</span><br><span class="line">      <span class="keyword">var</span> line_array = raw_array[a].split(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> b=<span class="number">1</span>;b&lt;line_array.length-<span class="number">1</span>;b++)&#123;</span><br><span class="line">        <span class="function"><span class="title">if</span>(<span class="params">line_array[b].length==<span class="number">2</span></span>)</span>&#123;</span><br><span class="line">          hexified+=line_array[b];</span><br><span class="line">          hexified=hexified.trim()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;MD5-返回值:&#x27;</span>);</span><br><span class="line">    <span class="built_in">console</span>.error(hexified+<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="修改入参-返回值"><a href="#修改入参-返回值" class="headerlink" title="修改入参/返回值"></a>修改入参/返回值</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line">onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;\t[-] &#x27;</span> + <span class="string">&#x27;onEnter args[0] class_name: &#x27;</span> + ObjC.Object(args[<span class="number">0</span>]).toString())</span><br><span class="line">	<span class="keyword">var</span> newval = ObjC.classes.NSString.stringWithString_(<span class="string">&quot;root/0;debug/0;proxy/0;inject/0&quot;</span>)</span><br><span class="line">  args[<span class="number">0</span>] = newval</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;\t[-] &#x27;</span> + <span class="string">&#x27;onEnter args[0] class_name: &#x27;</span> + ObjC.Object(args[<span class="number">0</span>]).toString())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> newuuid = ObjC.classes.NSString.stringWithString_(<span class="string">&quot;32427210-7773-7679-3993-A3F7-E85D212D7D91&quot;</span>)</span><br><span class="line">  retval.replace(newuuid)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="打印"><a href="#打印" class="headerlink" title="打印"></a>打印</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="keyword">new</span> ObjC.Object(ptr(args[<span class="number">2</span>])).toString();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;[*] str:] -&gt;&#x27;</span> , str);</span><br></pre></td></tr></table></figure>





<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//向内存写数据</span></span><br><span class="line"><span class="keyword">var</span> array = [<span class="number">0xaa</span>, <span class="number">0x12</span>, <span class="number">0x22</span>]</span><br><span class="line"><span class="comment">//可能存在权限问题，先修改内存权限</span></span><br><span class="line">Memory.protect(targetAddr, array.length, <span class="string">&#x27;rw-&#x27;</span>)</span><br><span class="line">Memory.writeByteArray(targetAddr, array)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> st = Memory.alloc(<span class="number">16</span>);</span><br><span class="line">st.writeByteArray([<span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x13</span>, <span class="number">0x89</span>, <span class="number">0x7F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x30</span>, <span class="number">0x30</span>, <span class="number">0x30</span>, <span class="number">0x30</span>, <span class="number">0x30</span>, <span class="number">0x30</span>, <span class="number">0x30</span>, <span class="number">0x30</span>]);</span><br><span class="line">...</span><br><span class="line">args[<span class="number">1</span>] = st;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">call a native <span class="function"><span class="keyword">function</span> </span></span><br><span class="line"><span class="function"><span class="title">const</span> <span class="title">address</span> = <span class="title">Module</span>.<span class="title">getExportByName</span>(<span class="params"><span class="string">&#x27;libsqlite3.dylib&#x27;</span>, <span class="string">&#x27;sqlite3_sql&#x27;</span></span>)</span>;</span><br><span class="line"><span class="keyword">const</span> sql = <span class="keyword">new</span> NativeFunction(address, <span class="string">&#x27;char&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>]);</span><br><span class="line">sql(statement);</span><br><span class="line"></span><br><span class="line">https:<span class="comment">//frida.re/docs/frida-cli/</span></span><br><span class="line">* enable Node.js compatible <span class="keyword">debugger</span></span><br><span class="line">$ frida Calculator -l calc.js --debug</span><br><span class="line">we can now run node-inspector and start debuging calc.js</span><br><span class="line"></span><br><span class="line">输出 </span><br><span class="line">$ frida-trace -p <span class="number">9753</span> --decorate -O additional-options.txt</span><br></pre></td></tr></table></figure>



<h5 id="base64编码解码"><a href="#base64编码解码" class="headerlink" title="base64编码解码"></a>base64编码解码</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">$ frida-trace -UF -m <span class="string">&quot;-[NSData base64EncodedStringWithOptions:]&quot;</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="title">onEnter</span>(<span class="params">log, args, state</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.self = args[<span class="number">0</span>];</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">onLeave</span>(<span class="params">log, retval, state</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> before = ObjC.classes.NSString.alloc().initWithData_encoding_(<span class="built_in">this</span>.self, <span class="number">4</span>);</span><br><span class="line">    <span class="keyword">var</span> after = <span class="keyword">new</span> ObjC.Object(retval);</span><br><span class="line">    log(<span class="string">`-[NSData base64EncodedStringWithOptions:]before=<span class="subst">$&#123;before&#125;</span>=`</span>);</span><br><span class="line">    log(<span class="string">`-[NSData base64EncodedStringWithOptions:]after=<span class="subst">$&#123;after&#125;</span>=`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ frida-trace -UF -m <span class="string">&quot;-[NSData initWithBase64EncodedData:options:]&quot;</span> -m <span class="string">&quot;-[NSData initWithBase64EncodedString:options:]&quot;</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="title">onEnter</span>(<span class="params">log, args, state</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.arg2 = args[<span class="number">2</span>];</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">onLeave</span>(<span class="params">log, retval, state</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> before = ObjC.classes.NSString.alloc().initWithData_encoding_(<span class="built_in">this</span>.arg2, <span class="number">4</span>);</span><br><span class="line">    <span class="keyword">var</span> after = ObjC.classes.NSString.alloc().initWithData_encoding_(retval, <span class="number">4</span>);</span><br><span class="line">    log(<span class="string">`-[NSData initWithBase64EncodedData:]before=<span class="subst">$&#123;before&#125;</span>=`</span>);</span><br><span class="line">    log(<span class="string">`-[NSData initWithBase64EncodedData:]after=<span class="subst">$&#123;after&#125;</span>=`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="title">onEnter</span>(<span class="params">log, args, state</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.arg2 = args[<span class="number">2</span>];</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">onLeave</span>(<span class="params">log, retval, state</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> before = <span class="keyword">new</span> ObjC.Object(<span class="built_in">this</span>.arg2);</span><br><span class="line">    <span class="keyword">var</span> after = ObjC.classes.NSString.alloc().initWithData_encoding_(retval, <span class="number">4</span>);</span><br><span class="line">    log(<span class="string">`-[NSData initWithBase64EncodedString:]before=<span class="subst">$&#123;before&#125;</span>=`</span>);</span><br><span class="line">    log(<span class="string">`-[NSData initWithBase64EncodedString:]after=<span class="subst">$&#123;after&#125;</span>=`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>







<p><a target="_blank" rel="noopener" href="https://la0s.github.io/2018/12/07/iOS_Crypto/">破解iOS加密数据</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/la0s/Frida-scripts">Frida-scripts  (base64|MD5|SHA1)</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/dpnishant/appmon/tree/master/scripts/iOS/Crypto">appmon project 提供的 scripts</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/theart42/hack.lu/blob/master/IOS/Notes/05-Crypt/00-crypto-hooks.md">hack.lu 的 scripts</a></p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/10/07/Python3%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98-7JavaScript%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E9%A1%B5%E9%9D%A2%E7%88%AC%E5%8F%962/" rel="prev" title="Python3网络爬虫开发实战-7JavaScript动态渲染页面爬取2">
                  <i class="fa fa-chevron-left"></i> Python3网络爬虫开发实战-7JavaScript动态渲染页面爬取2
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/10/18/iOS%E9%BB%91%E5%AE%A2%E6%94%BB%E9%98%B2/" rel="next" title="iOS黑客攻防">
                  iOS黑客攻防 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">daxun</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  <script src="/js/local-search.js"></script>















  








  

  

</body>
</html>
